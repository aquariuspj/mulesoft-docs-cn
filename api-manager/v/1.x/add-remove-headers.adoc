= 添加请求/响应头，删除请求/响应头
:keywords: header, policy

使用头策略的先决条件是：

* 假设您想要在Anypoint Platform中管理的API版本的组织管理员或API版本所有者的角色。应用策略是API版本管理任务。
* 确保您获得使用API​​管理器功能（Mule 3.8.x运行时）或API网关运行时2.x​​的许可。

== 下载添加或删除标题策略

目前，添加或删除标题策略在Anypoint Exchange上可用。按照分步过程下载，设置和应用这些策略。

要下载标题策略：

. 登录到Anypoint平台并转到Exchange。
. 搜索并下载政策，或使用以下网址：
+
* 添加请求标头策略
+
`+https://www.anypoint.mulesoft.com/exchange/?search=Add%20Request%20Headers%20Policy+`
+
* 删除请求标题策略
+
`+https://www.anypoint.mulesoft.com/exchange/?search=Remove%20Request%20Headers%20Policy+`
+
* 添加响应头策略
+
`+https://www.anypoint.mulesoft.com/exchange/?search=Add%20Response%20Headers%20Policy+`
+
* 删除响应头策略
+
`+https://www.anypoint.mulesoft.com/exchange/?search=Remove%20Response%20Headers%20Policy+`
+
. 解压每个策略存档。

XML和YAML文件出现在通过解压缩存档创建的每个文件夹中。例如，add-request-header-policy文件夹包含以下文件：

* 附加request.xml
* 附加request.yaml

您可以使用这些文件来设置稍后所述的策略。


== 设置和应用页眉策略

如果您在Anypoint Platform中配置了自定义策略，则添加或移除标题策略的过程基本相同。以下步骤显示如何在Anypoint Platform中设置和应用策略。

设置标题策略：

. 转到主API管理页面。
+
. 在主菜单下拉菜单中，选择自定义策略。 （右上角）
+
自定义策略会显示列出可用于API的自定义策略（如果有）。
+
. 点击添加自定义政策。
{Name}中输入该政策的名称，例如`add request header policy`。
. 在策略定义中，单击选择文件以查找您下载的示例中的YAML文件`add-request.yaml`。
. 在策略配置中，选择您下载的XML文件，例如`add-request.xml`。
. 点击添加。
+
image:gw-add-custom-pol.png[GW-附加定制-POL]
+
策略（在此示例中添加请求标头策略）显示在“自定义策略”页面上。
image:gw-custom-pol-list.png[GW-定制-POL列表]

=== 应用添加请求/响应头策略

继续添加请求标头策略的示例，请按照此过程中的步骤应用以下任一策略：

* 添加请求标头策略
* 添加响应标头策略

要应用添加请求标头策略或添加响应标头策略：

. 假设您已经部署了API版本，请在“API管理”页面上选择版本。
. 在API版本详细信息页面上，从项目列表中选择策略。
+
例如，添加请求标题策略出现在“可用策略”中。
+
如果标题已由客户端或其他策略提供，则该值将被您在此策略中提供的值覆盖。
+
. 点击应用。
+
出现应用添加请求标题策略对话框。
+
. 输入标题的名称和值。例如，在左侧键入`extra-header`，在右侧键入`myvalue`。
+
. （可选）在报头的值中包含MEL表达式。
+
例如，包含以下表达式以在头文本中替换用户代理的名称。
+
`'#[message.inboundProperties['user-agent']]'`
+
. 点击 image:gw-apply-pol-plus-icon.png[GW-申请-POL加图标]。
. 有选择地添加更多的标题名称和值，以相同的方式添加，然后点击应用。
+
您应用的策略从可用策略移至应用策略列表。

=== 应用移除请求/响应头策略

执行此过程中的步骤以应用以下任一策略：

* 删除请求标头策略
* 删除响应标题政策

要应用删除请求标头或删除响应标头策略：

. 滚动到版本页面的底部，然后从项目列表中选择策略。
+
策略（在此示例中删除请求标头策略）显示在“可用策略”中。
+
如果标题已由客户端或其他策略提供，则该值将被您在此策略中提供的值覆盖。
+
. 点击应用。
+
出现应用删除请求标头策略对话框。
+
. 键入要删除的每个标题的名称，用逗号分隔。
+
您可以使用通配符来删除具有相似名称的属性。例如，使用`foo-*`删除foo-bar，foo-test。
+
. 点击应用。
+
您应用的策略从可用策略列表移至应用策略列表。

== 测试策略应用程序

要测试策略的执行情况，请按照本节中的步骤应用策略并使用curl，例如`curl` `+http://localhost:8081 -vvv+`来测试策略。

=== 添加请求标头策略

测试添加或删除请求标头策略的过程假定您创建了一个记录后端服务收到的标头的mule应用程序。

. 如前一节所述，应用添加请求标头策略添加标头。
. 运行卷曲。
. 检查后端服务的日志以验证请求是否包含您在步骤1中配置的附加标题名称和值。


=== 删除请求标题策略

测试删除请求标头策略的过程假定您创建了一个记录后端服务收到的标头的mule应用程序。

. 如前一节所述，应用删除请求标头策略删除标头。
. 运行卷曲。
. 验证后端服务是否通过检查日志来排除额外的标头。


=== 添加响应头策略

. 运行卷曲。
. 检查响应以查看客户端正在接收哪些标头。
. 应用添加响应标头策略向标头添加响应。
. 再次运行curl。
. 验证是否收到指定的标题。

=== 删除响应头策略

. 运行卷曲。
. 检查响应以查看客户端正在接收哪些标头。
. 应用删除响应头策略以从头中删除响应。
. 再次运行curl。
. 确认指定的标题已被删除。

== 另请参阅

*  link:/api-manager/v/1.x/add-remove-headers-concept[关于添加/删除标题]
