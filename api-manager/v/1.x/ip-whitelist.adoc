= 应用IP白名单
:keywords: IP, whitelist, validation, policy

IP白名单策略允许IP地址的列表或范围访问配置的API端点并与之交互。

==  白名单IP地址访问您的API端点

您可以通过以下方式设置访问权限：

* 根据请求的IP地址进行访问
* 根据x-Forwarded-For标头的源IP地址进行访问

== 白名单基于请求的IP地址

. 点击API的版本号。
+
. 在API仪表板上，单击策略。
+
出现所有应用策略的列表。
+
. 应用新政策。
. 在“选择策略”中，选择“IP白名单”，然后单击“配置策略”。
. 指定一个地址或一个或多个地址如下：
+
* 定义特定的IP地址。例如，192.168.1.1。
* 通过识别子网掩码来定义地址的子集，例如192.168.3.1/30。这包括合并范围：192.168.3.0  -  192.168.3.3。
* 通过说明您想要允许的IP地址的相关八位组来定义一系列IP地址。例如，设置`192.168`将包含从192.168.0.0到192.168.255.255的IP地址。

要列出IP地址列表：

. 在*Whitelist*中输入一个或多个IP地址。
+
image::ip-whitelist-051a0.png[IP-白名单-051a0，高度= 353，宽度= 377]
+
. 点击+。
+
白名单文本输入字段下方显示灰色的IP地址和删除控件。
+
image::ip-whitelist-1b671.png[IP-白名单-1b671，高度= 353，宽度= 377]
+
. 点击*Apply*。

基于x-Forwarded-For标题的源IP地址的== 白名单

如果客户端通过HTTP代理或负载平衡器连接到API，则可能需要将客户端的特定IP（发起请求的IP）列入白名单，而不是请求中显示的地址。例如，如果您想将192.168.2.3列入白名单，并且此客户端通过HTTP代理92.40.1.255进行连接，则请求将显示为后者的公共地址。解决方法是，使用`X-Forwarded-For`标头标识重定向到端点的请求的源IP地址。

要使用`X-Forwarded-For`标头将发起请求的IP地址列入白名单，请执行以下操作：

. 在应用"IP whitelist"策略中，在*IP Expression*中使用Mule表达式来指示服务在Mule消息的“x-Forwarded-For”头中查找始发IP地址：
+
[source, EML]
----
#[message.inboundProperties['X-Forwarded-For’]]
----
+
. 在白名单中，输入一个或多个出现在请求中的IP地址。点击+。
. 点击应用。

API Manager查看排名在请求的“X-Forwarded-For”头部的连接值中的第一个IP地址。
