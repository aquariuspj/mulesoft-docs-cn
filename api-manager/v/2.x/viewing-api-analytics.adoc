= 查看API分析
:keywords: analytics, dashboard

登录到Anypoint Platform后，导航到API Manager，然后在“管理”页面上单击分析以打开仪表板。在仪表板中，您可以导航到有关由Anypoint Platform收集的API的分析。

*Note:*要查看Google Analytics图表，用户需要查看API配置权限。请参阅 link:/api-manager/v/2.x/environment-permission-task[设置权限]。

API Analytics数据最多可提供90天的图表相关信息，报告API最多可提供30天。

当您访问API的分析时，默认情况下，您将登录到显示这些图表的概览仪表板：

*  *Requests by Date*：折线图，显示组织中所有API的请求数。
*  *Requests by Location*：地图图，显示每个来源国的请求数量。
*  *Requests by Application*：条形图，显示来自前五个注册应用程序的请求数。
*  *Requests by Platform*：环形图，显示按平台细分的请求数量。

image:overviewdash1.png[overviewdash1]

默认情况下，这些图表显示过去一天贵组织中API的数据。您可以使用页面左上角的过滤器来更改日期范围或过滤到特定的API。时间范围反映您当地的时区。

image:filters.png[过滤器]

Overview Dashboard上的所有图表都被交叉过滤。如果过滤这些图表中的任何一个上的数据，则相同的过滤器将应用于页面上的其他图表。例如，单击条形图中的单个应用程序，会显示来自该应用程序的所有请求以及地图上这些请求的位置。以下是如何过滤各个图表上的数据。

[%header,cols="30a,30a,40a"]
|===
|图表 |如何过滤数据 |如何清除过滤条件
| *Requests by Date*  |单击并拖动图表的某个区域以过滤到该时间段。应用滑块过滤器后，您可以将端点向左或向右拖动以根据需要进行调整。 |单击过滤部分的区域外部。
| *Requests by Location*  |点击一个或多个国家/地区以过滤掉这些结果。将鼠标悬停在国家/地区上，显示所选国家/地区的国家/地区名称以及在该国家/地区收到的API请求总数。 |再次单击国家/地区重置地图。
| *Requests by Application*  |单击一个或多个应用程序栏以仅筛选这些结果。将鼠标悬停在应用程序的数据栏上，以显示该应用程序的名称以及该应用程序在该时间段内的请求总数。 |再次单击应用程序以重置图表。
| *Requests by Platform*  |点击一个或多个细分来过滤掉这些结果。将鼠标悬停在某个细分受众群上，显示该应用程序的名称以及该应用程序在该时间段内的请求总数。 |再次点击细分以重置图表。
|===

要导出任何这些图表的数据，请点击导出 image:export.png[出口]。

如果您在某个图表上过滤了数据以仅显示选定数据，则导出图标会触发导出该图表完整数据的.csv文件，并根据您使用过滤器的日期范围和API选择进行过滤页面的左上角。导出的文件限制为最多100万条记录。

== 在仪表板上包含政策违规行为

*Note:*用户必须设置“查看策略”权限才能查看策略或编辑“策略违规”警报。
有关更多信息，请参阅 link:/api-manager/v/2.x/environment-permission-task[设置权限]。

通过在仪表板上选中包括策略违规复选框来启用或禁用策略违规跟踪。仪表板将显示流量被拒绝或未被策略拒绝。

image::policy-violations-chart.png[]

== 创建自定义图表

//您必须拥有什么权限才能查看其他用户的图表？

您可以创建各种自定义图表来显示自定义仪表板上的特定数据。

例如，您可以创建显示以下内容的自定义图表：

* 每月第一天至今的每小时事务处理，按客户端ID，API版本或SLA层进行过滤。
* 过去24小时平均每分钟延迟，通过API过滤或按客户端地理位置分组。

* 每个订阅的应用程序分组的策略违规数量，违反的策略名称
+
只有违反了政策名称的图表才会包含触发政策违规的事件。所有其他图表排除这些事件。例如，API获取100个请求，90个成功，10个被限速策略拒绝。未按违规策略名称进行分组的图表仅基于非速率限制的90个请求计算聚合。然而，违反策略名称组合的图表在其计算中包含所有100个请求。

要创建自定义图表，请点击管理图表：

. 在API管理器>分析>管理图表中，单击新建。
+
出现创建图表。
+
image:createchart.png[createchart]
+
. 填写*Title*，以及可选的*Description*。
. 点击图表类型图表：
+
[%header,cols="20a,20a,60a"]
|===
|图标 |图表类型 |图表选项
| image:line-chart-icon.png[线图，图标]  |折线图
|数据源，度量标准：_metrics_和总计，数据间隔：_durations_
| image:bar-chart-icon.png[柱形图图标]  |条形图
|数据源，度量标准：_metrics_和总计，分组依据：_categories_
| image:stack-chart-icon.png[堆叠图表图标]  |堆栈图
|数据源，度量标准：_metrics_和总计，分组依据：_categories_，然后由：_categories_
| image:ring-chart-icon.png[环图表图标]  |环形图
|数据源，度量标准：_metrics_和总计，分组依据：_categories_
| image:map-chart-icon.png[地图图表图标]  |地图
|数据源，度量标准：_metrics_和Total
|===
+
. 选择一个数据源值：
+
** 组织中的所有API
** 一个特定的API
+
. 从指标_metrics_值和总数中选择一个：
+
** 请求大小（以字节为单位）
** 请
** 响应大小（以字节为单位）
** 响应时间（以毫秒为单位）
+
. 对于折线图，选择数据间隔_durations_值：
+
** 分钟
** 小时
** 天
+
. 对于条形图或堆栈图，请为分组依据选择一个分类，如果您的图表支持该分类，那么Then By：
+
**  API名称
**  API版本
** 申请
** 浏览器
** 城市
** 客户端IP
** 洲
** 国家
** 硬件平台
**  OS系列
** 操作系统主要版本
** 操作系统次要版本
** 操作系统版本
邮编** 
** 资源路径
** 状态码
** 时区
** 用户代理类型
** 用户代理版本
** 动词
** 违反了政策名称
+
对于堆栈图，您可以将数据分为两个不同的维度。第一个定义了不同的列，第二个定义了这些列中的堆栈。第二个分组维上的选项与第一个分组维相同。
+
. 保存图表。
+
自定义图表出现。

=== 示例自定义图表：每个应用程序的策略违规

. 在API管理器>分析>管理图表中，单击新建。
. 在标题中，键入*Policy Violations Per Application*。
. 在描述中，键入*Number of violations per subscribed application*
. 选择堆叠图表。
+
. 在数据源和度量中，接受默认值。
. 为堆栈图选择两个级别的分组：
+
* 选择应用程序以将每个应用程序显示在不同的列中。
* 选择违规的策略名称作为每列中的堆栈。
+
image:create-chart-2.png[创建-图表-2-]
+
. 保存图表。
+
图表出现：
+
image:analytics-violated-policies-2.png[分析-违反的政策-2]

== 创建自定义信息中心

创建自定义图表后，您可以将它们并排显示在自定义仪表板上，这对您而言是独一无二的。

要访问您的自定义仪表板，请点击自定义仪表板。第一次打开自定义仪表板时，它是空白的。

. 在API管理器>分析>自定义仪表板中，点击编辑仪表板。
. 假设您创建了自定义图表，请将图表从屏幕左侧的抽屉中拖放到仪表板上，然后根据需要将它们重新排列，直到您想要的顺序。
+
向您的信息中心添加图表后，您可以选择将其打开进行编辑，也可以点击X将其从信息中心中删除。
. 如果您对自定义信息中心感到满意，请保存它。
+
自定义仪表板出现。

image:custom-dashboard.png[定制仪表板]

使用日期范围选择器可以调整仪表板上所有图表的时间段。

== 导出Google Analytics数据

您可以从概览仪表板或自定义仪表板上显示的图表中导出分析数据。在任一仪表板上，点击导出 image:export.png[]下载包含该图表数据的CSV文件。


您下载的数据反映了您选择的过滤选项。但是，如果您要从概览仪表板导出图表数据，并且选择了图表的一个或多个子部分，则导出的文件不包含筛选选项。导出的文件包含该图表的完整数据。

== 另请参阅

*  link:/api-manager/v/2.x/analytics-event-api[Analytics事件API]

