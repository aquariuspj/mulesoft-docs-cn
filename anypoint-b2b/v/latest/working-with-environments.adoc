
= 使用环境

:keywords: b2b, portal, partner, manager, environments
<Begin New Text>

包括:: / _源/促销物scenarios.adoc [leveloffset = + 1]


=== 粗体草稿图片，用于证书宣传
image:PromoteIDsOffCertsOn.png[“草稿图形，证书提升方案”]


</新文本




<Begin Existing Text>



== 从环境中导出合作伙伴

Anypoint合作伙伴管理器（APM）提供了将合作伙伴导出用于备份的功能。这些合作伙伴可以稍后导入APM。有关更多信息，请参阅<<Importing Partners Into A Specific Environment>>部分。
出口合作伙伴涉及一系列步骤。从合作伙伴名单中：

. 从列表中选择一个或多个合作伙伴。这将导致启用"Export"按钮。
. 点击"Export"按钮。这将弹出一个确认窗口，列出将要出口的所有合作伙伴。您可以点击"Dismiss"取消该过程。
. 点击窗口上的导出按钮。这将启动导出过程，完成后，它将下载带有所选伙伴及其相关数据的纯文本文件。

请不要指出文件是自动命名的。文件名称模式由词"partners_export"组成，并具有当前日期后缀，例如， "partners_export_2016-07-12.txt"

== 将合作伙伴导入特定环境

Anypoint Partner Manager（APM）可以导入之前使用导出功能备份的<<Partners>>。请参阅<<Exporting partners from an environment>>部分了解更多信息。
只有拥有适当角色或权限的用户才能导入合作伙伴。目标环境可能已经有相同的正在导入的合作伙伴。如果是这种情况，来自正在导入的合作伙伴的数据将覆盖现有合作伙伴的数据。
导入合作伙伴涉及一系列步骤，从合作伙伴列表屏幕开始：

. 找到右上角的"New Partner"。点击按钮旁边的小箭头，然后选择"Import"。这会弹出"Import"窗口。您可以点击"Dismiss"取消该过程。
. 选择"target environment"，这是合作伙伴导入的环境。点击"Next"。
. 通过点击"Choose File"并浏览您的文件系统，选择与合作伙伴（之前导出的文件）的文件。此时，如果需要，您可以点击"Back"更改选定的目标环境。
. 选择在目标环境中匹配现有或以前导入的合作伙伴时，正在导入的合作伙伴是否保留其标识符。
. 选择要导入的合作伙伴是保留其AS2证书还是使用目标环境中匹配的现有或先前导入的合作伙伴的证书。点击导入来启动过程。

促进合作伙伴进入特定环境。== 

Anypoint合作伙伴管理器（APM）可以将"promote"，即"copy"，<<Partners>>从一个环境转移到另一个环境。
只有具有适当角色或权限的用户才能够宣传合作伙伴。该流程涉及一系列步骤，从合作伙伴列表屏幕开始：

. 从列表中选择一个或多个合作伙伴进行宣传。
. 点击"Promote"按钮。这会弹出列出要升级的合作伙伴的"Promote"窗口。您可以点击"Dismiss"取消该过程。
. 选择"target environment"，这是合作伙伴晋升的环境。点击"Next"进入下一步。或者，如果需要，您可以点击"Back"更改选定的目标环境。
. 选择在与目标环境中的现有或以前导入的合作伙伴匹配时，正在升级的合作伙伴是否保留其标识符。
. 选择要导入的合作伙伴是否保留其AS2证书或使用目标环境中匹配的现有或先前推广的合作伙伴的证书。点击导入来启动过程。
////

促销方案。== 促销方案
促进合作伙伴是一个比进口更为复杂的程序。
假设在环境ENV_A上创建了一个合作伙伴，然后提升为ENV_B。随后，可以将同一个合作伙伴一遍又一遍地从ENV_A提升到ENV_B。每次促销发生时，目标环境中合作伙伴的值都将使用源环境中该合作伙伴的值进行更新。
但是，根据特定条件，并非所有值都会更新（特别是标识符和AS2证书），甚至可能完全拒绝提升。这些条件被分组到特定的场景中，从而影响升级过程的结果。以下是对可能情况及其结果的描述：

=== 证书和促销。
* 假设源环境E1上有伙伴P1。
* 假设P1已经升级到目标环境E2。
* 再次将P1从E1提升到E2，但选择"Override Certificates"应使用P1在E1上拥有的证书更新E2上的证书。或者，不选择"Override Certificates"应该保持E2上的P1证书不变。

=== 标识符和促销

==== 情景1
* 假设源环境E1上有伙伴P1。
* 假设某个目标环境E2上有相同的伙伴P1。这可能是以前的促销活动造成的。此时E1中的P1和E2中的P1是精确的副本。
* 现在假设已经为P1配置了一组用于AS2，EDI X12和EDIFACT的标识符（类型和值）。
* 将P1从E1提升为E2，选择"Keep Existing Identifiers"，将尝试将"copy" P1转换为E2。由于ENV2中的P1没有任何标识符，它们将从E1中复制，因为复制的日期可能需要标识符信息（例如端点或文档定义）
* 或者，将E1从E1提升到E2，不选择"Keep Existing Identifiers"，也会尝试将P1复制到E2中，包括标识符。这是正常促销程序的一部分（即将合作伙伴从一个环境复制到另一个环境）

请注意，在这种情况下，如果目标环境P2具有与P1相同的标识符（即类型和值）的_any_其他伙伴（例如PX），则促销将失败。这是因为多次使用相同的一组标识符（类型和值）是非法的。

==== 情景2
* 假设源环境E1上有伙伴P1。
* 假设某个目标环境E2上有相同的伙伴P1。这可能是以前的促销活动造成的。此时E1中的P1和E2中的P1是精确的副本。
* 现在假设已经为P1配置了一组用于AS2，EDI X12和EDIFACT的标识符（类型和值）。然后，假设为E2中的P1配置了AS2，EDI X12和EDIFACT的_different_一组标识符（类型和值）。
* 将P1从E1提升为E2，选择"Keep Existing Identifiers"，将尝试将"copy" P1转换为E2。由于ENV2中的P1具有不同的标识符（类型和值），因此它们将作为正常升级过程的一部分复制到E2中（请记住，它旨在将合作伙伴从一个环境复制到另一个环境，并随后"copies"更新目标环境中源环境的值）
* 或者，将P1从E1提升到E2，不选择"Keep Existing Identifiers"，将使E2中为P1设置的标识符保持不变。这只是正常的过程，因为这个选项基本上告诉不要触摸目标环境中的标识符。

==== 情景3
* 假设源环境E1上有伙伴P1。
* 假设某个目标环境E2上有相同的伙伴P1。这可能是以前的促销活动造成的。此时E1中的P1和E2中的P1是精确的副本。
* 现在假设为E2中的P1配置了一组用于AS2，EDI X12和EDIFACT的标识符（类型和值）。此时P1在E2中设置了一些标识符，而在E1中保存的拷贝没有。
* 将E1从E1提升到E2，不选择"Keep Existing Identifiers"，对E2中的标识符不起作用。这是因为促销过程不能故意删除E2中可能已经定义的标识符，因为它们可能在现有的文档定义或端点中需要（请记住，它旨在将合作伙伴的副本从一个环境复制到另一个环境）
* 或者，将P1从E1推广到E2，但选择"Keep Existing Identifiers"将不会对E2中的标识符产生任何影响。这只是正常的过程，因为这个选项基本上告诉不要触摸目标环境中的标识符。

==== 情景4：标识符和促销冲突
* 假设源环境E1上有伙伴P1。假设P1有一组用于AS2，EDI X12和EDIFACT的标识符（类型和值）。
* 假设某个目标环境E2上有一个合作伙伴P2。假设P2无论出于何种原因都与E1上的P1完全相同
* 在选择"Keep Existing Identifiers"的同时将P1从E1提升为E2，将尝试将"copy" P1转换为E2。这将导致在E2中创建一组标识符。但是，多次使用相同的标识符值是非法的，因此促销将失败。 "Promotion"窗口将显示一条消息，通知此情况。
