= 自动执行任务
:keywords: tcat, admin shell, server

Admin shell允许您通过编写脚本轻松构建和安装自己的Tcat Server扩展。然后，您可以在启动时运行脚本，或使用类似cron的调度机制来调度脚本。脚本使用类似Java的Groovy脚本语言编写。有关Groovy的更多信息，请参阅 link:http://groovy-lang.org/[Groovy的]。

默认情况下，Tcat服务器包含两个预定脚本：

* 心跳：ping所有寻找未注册Tcat服务器实例的服务器。你不需要修改这个脚本。
* 使用统计：向MuleSoft发送匿名信息。有关更多信息，请参阅 link:/tcat-server/v/7.1.0/scheduling-the-usage-statistics-script[计划使用统计信息脚本]。

有关脚本的更多示例，请参阅 link:/tcat-server/v/7.1.0/scripting-examples[脚本示例]。有关控制脚本日志记录的信息，请参阅 link:/tcat-server/v/7.1.0/working-with-logs[Shell脚本日志]。

== 创建脚本

要创建脚本，请转至管理选项卡，点击*Admin Shell*，然后输入您的脚本。例如，您可以输入以下文本：

[source,bash, linenums]
----
println "Hello"
----

然后，您可以点击*Evaluate*运行脚本一次。如果它没有任何错误地工作，您可以将脚本保存到您可以安排它作为计划作业运行。要保存脚本，请为其输入一个唯一名称，然后点击*Save*。如果您始终希望此脚本在Tcat Server启动时运行，请单击*Run on startup*。

要将现有脚本用作新脚本的模板，请单击屏幕右侧的现有脚本，进行修改，然后单击*Save As*，然后为脚本输入一个新名称。

== 修改脚本

要编辑现有脚本，请在屏幕右侧单击其名称，进行修改，然后单击*Save*。您可以随时点击*Reset*返回上次保存的脚本版本。

要删除脚本，请在屏幕右侧单击它，然后单击*Delete*。

== 计划脚本

您可以使用调度程序定期运行脚本，这对复制等作业很有用。

=== 创建预定作业

创建预定作业：

. 在管理标签上，点击*Scheduler*，然后点击*New*。
. 选择要运行的脚本。
. 输入计划作业的唯一名称和说明。
. 输入<<Cron Command Syntax>>指定脚本何时运行。
. 即使脚本的最后一次执行仍在运行，为了允许运行此脚本，请单击*Allow Concurrent Execution*。
. 点击*Save*。

[CAUTION]
单击*Save*保存计划作业后，脚本将按指定的计划运行，直到您删除作业。

=== 删除预定作业

要删除预定作业：

. 点击管理标签上的*Scheduler*。
. 单击您想要删除的计划作业。
. 点击*Delete*，然后点击*OK*以确认您要删除此作业。

==  Cron命令语法

指定cron命令时使用以下语法：

[%header,cols="4*"]
|===
|字段名称 |强制性 |允许的值 |允许的特殊字符
|秒 |是 | 0-59  |， -  * /
|分钟 |是 | 0-59  |， -  * /
|小时数 |是 | 0-23  |， -  * /
|每月的某天 |是 | 0-31  |， -  * / L W
|月 |是 | 1-12或JAN-DEC  |， -  * / +
|星期几 |是 | 1-7或SUN-SAT  |， -  * / L＃
|年份 |否 |为空，1970-2099  |， -  * /
|===

以下是对特殊字符的描述：

[%header,cols="10,90"]
|===
| {字符{1}}说明
|， |分隔各个值，例如分钟位置的0,30，以在小时和半小时内运行作业。
|  -   |指定一系列值，例如Day Of Week中的MON-FRI位置以在工作周的每一天运行作业。
在星期几位置指定| * |Specifies all values for that position, such as every day of the week when *。
|？ |跳过设置该位置的值。由于星期几和月份的日期是互斥的，请务必使用？在其中一个字段中指定*或另一个的特定值。
| /  |指定增量，例如，当在秒位置指定1/15时，从每分钟的第一秒开始每隔15秒。
| L  |根据位置指定月份或星期的最后一天。
| W  |指定最接近指定日期的工作日，例如在星期几位置指定3W的月份的最靠近月份的第三个工作日运行作业。
|＃{ |指定一个星期中的某一天发生的月份，例如在每周的第二个星期五运行作业，方法是在Day of Week位置指定6＃2（其中6是一周的第六天或星期五，＃2指定当月的第二天）。
|===

以下是一些cron命令的例子：

[%header,cols="30,70"]
|===
| {命令{1}}说明
| 0 0 12 * *？ |每天12点（中午）。请注意，没有指定年份，因为年份的位置是可选的。
| 0 15 10？ * * +
0 15 10 * *？ +
0 15 10 * *？ * +
0 15 10 * *？ ？ |这些命令中的任何一个都在每天上午10点15分执行作业
| 0 0/5 14 * *？ |每5分钟从下午2点开始，结束于下午2点55分，每天
| 0 0/5 14,18 * *？ |每5分钟从下午2点开始，结束于下午2点55分，每5分钟从6点开始到6点结束： 55pm，每天
| 0 0/5 14-16 * *？ |每5分钟从下午2点开始，结束于下午4点55分，每天
| 0 10,44 14？ 3月3日每周三下午2点10分和下午2点44分 |
| 0 15 10？ * 2010年6月2010年 | 2010年，2011年和2012年每月最后一个星期五上午10:15
|===

有关cron命令及其选项的更多信息，请参阅 link:http://www.quartz-scheduler.org/[Quartz Scheduler]文档。

link:/tcat-server/v/7.1.0/working-with-logs[<<上一页：*使用日志*]

link:/tcat-server/v/7.1.0/scripting-examples[Next：*脚本示例* >>]
