= 安装并测试您的连接器

使用Maven和您的IDE构建了一个项目后，您可以在Studio中安装骨架连接器以确认其基本功能，然后再添加更多操作。本文档描述了在Mule Studio中构建，然后安装和测试连接器的步骤。这个过程的宏观步骤如下：

. 设置必需的@Connector注释。
. 向连接器添加一个"say hello"操作。
. 记录"say hello"操作。
. 使用Maven构建连接器项目。
. 在Studio中安装连接器。
. 测试连接器的基本功能。

== 假设

本文假设您有 link:/anypoint-connector-devkit/v/3.4/creating-a-connector-project[创建一个连接器项目]。

== 设置@Connector注释参数

Maven生成的类上的@Connector注释具有必需的参数：`friendlyName`。 （请参阅下面的示例。）此参数为连接器定义了人类可读的名称，该名称在Studio的调色板中显示为连接器的标签。如果没有这个参数，连接器不会出现在3.4.0之后的Mule Studio版本的调色板中。

[source, java, linenums]
----
@Connector(name = "helloConnector", schemaVersion = "1.0-SNAPSHOT", friendlyName = "Hello")
----

== 添加一个操作

您创建的连接器项目立即准备好构建，然后在Mule Studio中进行安装和测试。但是，为了使测试更有趣，您可以将接收名称的连接器添加为字符串的操作，并返回以"Hello"开头的相同名称。按照以下步骤添加此操作。

. 在您的IDE中，打开主要Java文件**`src/main/java/org.mulesoft.hello/HelloConnector.java`**
. 在最后一个大括号之前，将以下代码粘贴到连接器类的最后。使用标识符**`uname`**，因为标识符**`name`**是保留的;你不能用它作为参数。
+
[source, code, linenums]
----
/**
* Custom processor
*
* {@sample.xml ../../../doc/hello-connector.xml.sample hello:say-hello}
*
* @param uname Name to be processed
* @return Some string
*/
@Processor
public String sayHello(String uname)
{
    return "Hello " + uname;
}
----
  
. 确认完整的类显示如下。
+
[source, code, linenums]
----
/**
* This file was automatically generated by the Mule Development Kit
*/
package TestConnector;
import org.mule.api.annotations.Connector;
import org.mule.api.annotations.Connect;
import org.mule.api.annotations.ValidateConnection;
import org.mule.api.annotations.ConnectionIdentifier;
import org.mule.api.annotations.Disconnect;
import org.mule.api.annotations.param.ConnectionKey;
import org.mule.api.ConnectionException;
import org.mule.api.annotations.Configurable;
import org.mule.api.annotations.Processor;
/**
* Cloud Connector
*
* @author MuleSoft, Inc.
*/
 
@Connector(name="helloConnector", schemaVersion="1.0-SNAPSHOT", friendlyName="Hello")
public class HelloConnector
{
 
    /**
    * Configurable
    */
    @Configurable
    private String myProperty;
 
    /**
    * Set property
    *
    * @param myProperty My property
    */
    public void setMyProperty(String myProperty)
    {
        this.myProperty = myProperty;
    }
 
    /**
    * Get property
    */
    public String getMyProperty()
    {
        return this.myProperty;
    }
 
    /**
    * Connect
    *
    * @param username A username
    * @param password A password
    * @throws ConnectionException
    */
    @Connect public void connect(@ConnectionKey String username, String password)
    throws ConnectionException
    {
 
        /**
        * CODE FOR ESTABLISHING A CONNECTION GOES IN HERE
        */
    }
 
    /**
    * Disconnect
    */ @Disconnect
    public void disconnect()
    {
 
        /**
        * CODE FOR CLOSING A CONNECTION GOES IN HERE
        */
    }
 
    /**
    * Are we connected
    */
    @ValidateConnection public boolean isConnected()
    {
        return true;
    }
 
    /**
    * Connection Identifier
    */
    @ConnectionIdentifier public String connectionId()
    {
        return "001";
    }
 
    /**
    * Custom processor
    *
    * {@sample.xml ../../../doc/MyTest-connector.xml.sample mytest:my-processor}
    *
    * @param content Content to be processed
    * @return Some string
    */ @Processor
    public String myProcessor(String content)
    {
        /**
        * MESSAGE PROCESSOR CODE GOES HERE
        */
        return content;
    }
 
    /**
    * Custom processor
    *
    * {@sample.xml ../../../doc/hello-connector.xml.sample hello:say-hello}
    *
    * @param uname Name to be processed
    * @return Some string
    */ 
 
 
 @Processor
    public String sayHello(String uname)
    {
        return "Hello " + uname;
    }
}
----

=== 记录操作

由于DevKit强制执行所有项目的正确文档，因此您必须提供至少一个如何使用添加到连接器的每项操作的示例。如果您尝试在没有文档的情况下构建项目，则构建失败。

. 在您的IDE中，打开文件**`doc/Hello-connector.xml.sample` **，然后粘贴以下代码片段。
+
[source, xml, linenums]
----
<!-- BEGIN_INCLUDE(hello:say-hello) -->
 
    <hello:say-hello uname="#[payload.uname]" />
 
<!-- END_INCLUDE(hello:say-hello) -->
----
  
. 确认文件的完整内容如下所示。
+
[source, xml, linenums]
----
<!-- BEGIN_INCLUDE(hello:my-processor) -->
 
    <hello:my-processor content="#[map-payload:content]" />
 
<!-- END_INCLUDE(hello:my-processor) -->
 
 
 
<!-- BEGIN_INCLUDE(hello:say-hello) -->
 
    <hello:say-hello uname="#[payload.uname]" />
 
<!-- END_INCLUDE(hello:say-hello) -->
----

[NOTE]
====
请注意，我们的Java文件中处理器的名称是`sayHello`，但在示例XML文件中，名称是`say-hello`。

DevKit自动将处理器的CamelCase名称转换为带连字符的名称，因此它不会识别示例XML文件中标记为`sayHello`的处理器。
====

== 使用Maven构建项目

此时连接器已准备好第一次被构建和使用。 Maven自动化构建连接器，运行测试以及将其打包到Mule Studio中使用的过程。

如果使用Studio作为IDE，请注意，开发Mule项目的Maven支持不适用于构建DevKit项目。因此，您必须使用Maven和命令行或使用`m2e`菜单命令构建连接器。

. 要编译项目，请访问命令控制台，然后在项目目录中运行以下命令。
+
[source, code, linenums]
----
mvn clean package -Ddevkit.studio.package.skip=false
----

  
.  IDE中的目标文件夹现在包含一个完全可用的 - 尽管非常基本的连接器，可以在Mule Studio中进行安装。


== 在Mule Studio中安装连接器

. 在*Mule Studio*的`Help`菜单下，选择`Install New Software`。
. 点击*Work with*字段旁边的**Add...**，然后输入以下值：+
..  *Name*：`Hello Connector`
..  *Location*：连接器的**update-site.zip**文件（位于`target`文件夹中）的文件路径前加`file:/`

. 在过滤器字段下方的表格中（见下图），使用复选框选择您的Mule扩展名（即连接器（单击以展开文件夹以选择单个项目），然后单击*Next*。
. 查看您选择的项目的详细信息，然后点击*Next*。
. 点击接受产品的条款和条件，然后点击*Finish*。
. 点击*Restart Now*完成安装。
.  Studio重新启动后，展开Cloud Connectors调色板组以查看您的新Hello连接器。

== 测试连接器

要查看您的新连接器功能，请创建，然后运行使用Hello连接器的Mule应用程序。

[tabs]
------
[tab,title="STUDIO Visual Editor"]
....

. Create a simple flow using an *HTTP endpoint* and your new *Hello connector*. Use the default values configured in the HTTP endpoint (*port*:`8081`, *host*: `localhost`).
. Select the connector to open the properties editor. Notice the parameters Studio makes available to the end user to configure. Configure the parameters according to the table below.
+
[%header%autowidth.spread]
|===
|Parameter |Value
|*Display Name* |`Hello`
|*Config Reference* |see next step
|*Operation* |`Say hello`
|*Uname* |`#[message.inboundProperties['uname']]` 
|===

. Click the plus sign next to the *Config Reference* field to create a new global element for your connector to use.
. In the *My Property* field, enter any string as the value, then click *OK*.
. Save, then run the project as a Mule Application (right-click project name, then select **Run As > Mule Application**).
. From a browser, navigate to `http://localhost:8081/?uname=Dave`
. The application returns the response in your browser (see below).

....
[tab,title="Studio XML Editor"]
....

. Create a simple flow using an *`http:inbound-endpoint`* and your new **`hello:config`**. Configure the parameters of each element according to the code sample below.
+
[source, xml, linenums]
----
<mule xmlns:hello="http://www.mulesoft.org/schema/mule/hello" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/hello http://www.mulesoft.org/schema/mule/hello/1.0-SNAPSHOT/mule-hello.xsd"> 
    <hello:config name="Hello" myProperty="asdf" doc:name="Hello">
        <hello:connection-pooling-profile initialisationPolicy="INITIALISE_ONE" exhaustedAction="WHEN_EXHAUSTED_GROW"/> 
    </hello:config> 
    <flow name="Hello-connector-testFlow1" doc:name="Hello-connector-testFlow1"> 
        <http:inbound-endpoint exchange-pattern="request-response" host="localhost" port="8081" doc:name="HTTP"/> 
        <hello:say-hello config-ref="Hello" uname="#[message.inboundProperties['uname']]" doc:name="Hello"/> 
    </flow> 
</mule>
----

. Save, then run the project.
. From a browser, navigate to `http://localhost:8081/?uname=Dave`
. The application returns the response in your browser.

....
------

== 另请参阅

连接器上的*  **NEXT STEP:** link:/anypoint-connector-devkit/v/3.4/authentication-and-connection-management[实施认证]。
