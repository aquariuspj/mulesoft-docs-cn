=  Siebel Connector 3.0.0
:keywords: siebel connector

_Premium_

适用于Siebel的Anypoint Connector允许您访问Mule集成应用程序与Oracle Siebel客户关系管理器（CRM）之间的连接。

*Release Notes*： link:/release-notes/siebel-connector-release-notes[Siebel连接器发行说明]

Siebel连接器由三个连接器组成，每个连接器提供与Siebel应用程序连接的不同选项：+

*Oracle Siebel Business Objects:*创建，更新，插入，查询和删除Siebel业务组件。 +
*Oracle Siebel Integration Objects:*创建，更新，插入，查询，删除，查询页面，执行和同步Siebel集成对象。 +
*Oracle Siebel Business Services:*执行Siebel业务服务。

在安装相应的Siebel连接器后，每个选项都可用。
Siebel连接器使用Siebel Java Data Beans接口构建。 Java Data Beans提供了一个本地Java接口来访问Siebel对象管理器。
Siebel Object Manager允许连接器使用不依赖于定制安装的通用接口。要在设计时发现Siebel对象的元数据，请在Anypoint Studio中使用DataSense。 Siebel连接器利用Siebel存储库在Siebel自定义安装中显示可用对象及其结构的列表。
对象可以是基于您安装的连接器类型的业务组件，业务对象，集成对象或业务服务。


== 先决条件


由于连接器与Siebel CRM紧密相连，本文假设您具有Siebel业务组件，业务对象，业务服务和集成对象的工作知识。
本文档假定您熟悉Mule， link:/mule-user-guide/v/3.7/anypoint-connectors[Anypoint连接器]和 link:/anypoint-studio/v/5/index[Anypoint Studio Essentials]。为了增加对Studio的熟悉度，
考虑完成一个或多个 link:/anypoint-studio/v/5/basic-studio-tutorial[基本工作室教程]。进一步，
本页假定您对 link:/mule-user-guide/v/3.7/elements-in-a-mule-flow[骡子流中的元素]和 link:/mule-user-guide/v/3.7/global-elements[骡全球元素]有基本的了解。

本文档描述了Anypoint Studio，Mule ESB的图形用户界面的上下文中的实现示例，
包括在XML编辑器中执行相同的配置细节。

=== 要求

Siebel连接器需要以下两个Siebel JAR文件：*Siebel.jar*和*SiebelJI_xxx.*。

根据Siebel安装的区域设置选择*SiebelJI_xxx.jar*。例如，如果Siebel安装的区域设置是*US_EN*，请使用*SiebelJI_enu.jar*。
*Siebel.jar*和*SiebelJI_enu.jar*在Siebel服务器上的*<%SIEBEL_HOME%>\8.1\Tools_1\CLASSES*文件夹中可用。 ％SIEBEL_HOME％是Siebel的安装目录。


您可以在配置Siebel全局元素的同时将JAR文件添加到您的Studio项目中。了解如何配置Siebel连接器全局元素。

=== 依赖
该连接器需要Mule运行时才能工作。

=== 兼容性矩阵

[%header]
|=======
|应用/服务 |版本
| Mule运行时 | 3.6.1或更高版本
| {的Siebel {1}} V8.1
|=======



Siebel v3.0.0连接器是使用Oracle Siebel 8.1构建和测试的。由于Java Data Bean接口是通用的，因此Siebel v3.0.0连接器可与Siebel版本7.7,7.8和8.0配合使用。但是，连接器与8.1以外的任何其他版本的兼容性尚未经过测试。该连接器与Siebel v7.5及更低版本不兼容。

== 安装此连接器

. 在Anypoint Studio中，点击Studio任务栏中的Exchange图标。
. 点击Anypoint Exchange中的登录。
. 搜索连接器，然后单击安装。
. 按照提示安装连接器。

Studio有更新时，会在右下角显示一条消息，您可以单击该消息来安装更新。

您必须选择要安装的Siebel连接器（在Oracle Siebel业务对象，Oracle Siebel业务服务和Oracle Siebel集成对象之间进行选择）。每个Siebel连接器都是分开安装的。

要在生产环境中使用Siebel连接器，您必须具有Enterprise许可证才能使用Mule
或者CloudHub Starter，Professional或Enterprise帐户。

联系MuleSoft销售团队安排许可证。另请参阅 link:/mule-user-guide/v/3.7/installing-an-enterprise-license[安装企业许可证]。
Studio将显示您在调色板中安装的Siebel连接器。显示的连接器是：

*Oracle Siebel Business Objects*：连接至定义业务逻辑并封装表数据的Siebel业务对象和组件。

*Oracle Siebel Business Services*：连接到Siebel业务服务以执行特定的业务功能或任务。

*Oracle Siebel Integration Objects*：连接到Siebel集成对象，提供业务组件的动态和分层结构


=== 创建一个新项目

要在Mule应用程序项目中使用*Siebel connector v3.0.0*：

. 在Studio中，选择*File > New > Mule Project*。
. 为您的新项目输入一个名称，并将其余选项保留为默认值。
+
image:siebel-proj.png[于Siebel的PROJ]
+
. 如果您计划使用Git，请选中该项目的*Create a .gitignore file*复选框，为Studio Projects创建一个默认的`gitignore`文件（更多信息请参阅 link:/mule-user-guide/v/3.7/preparing-a-gitignore-file[准备一个gitignore文件]），然后点击*Next*。

. 点击*Finish*创建项目。


=== 配置Siebel全局元素

要在您的Mule应用程序中使用*Siebel connector v3.0.0*，您必须为您希望使用的Siebel连接器配置一个全局元素：

*  *Business Objects*

*  *Business Services*

*  *Integration Objects*

要在Mule应用程序中配置Siebel连接器全局元素：
[tabs]
------
[tab,title="Studio Visual Editor"]
....

. Click the *Global Elements* tab at the base of the canvas.
. On the Global Mule Configuration Elements screen, click *Create*.
. In the Choose Global Type wizard, expand *Connector Configuration*, and then select the connector you want to configure: *Oracle Siebel Business Objects*, *Oracle Siebel Business Services*, or *Oracle Siebel Integration Objects*.
+
. Click *OK*
. Enter the global element properties: +
+
.. For the Oracle Siebel Business Objects connector: +
+
image:siebel-bo-config.png[siebel-bo-config]
+

[%header,cols="30,70a"]
|===
|Field |Description
|*RSA Encryption* |Choose if you want to use RSA encryption.
|*Name* |Enter a name for this connector to reference it later.
|*User* |Enter the Siebel username to be used.
|*Password* |Enter the corresponding Siebel password.
|*Server* |Enter the server IP address of your Siebel instance.
|*Port* |Enter the port number.
|*Server Name* |Enter the Siebel Enterprise server name.
|*Object Manager* |Enter the value of the Object Manager of your Siebel instance. The default value is `EAIObjMgr_enu`.
|*Language* |Enter the language corresponding to the locale of the Siebel instance.
|*Encoding* |Enter an encoding type supported by the Siebel server.
|*Enable DataSense* |This option is selected by default. If you want to disable the option, click the checkbox to clear it.
|*DataSense Filters Business Components:* | (Composed of the two fields below, *Default View Mode* and *DataSense Filter Query*)
|*Default View Mode* a|
Enter the default view for DataSense. The default value for this field is 3.

Supported values: +

* *0 (SalesRepView):* +
** Applies access control according to a single position or a sales team.
** Displays records according to one of the following items: The user position or the sales team that includes a user's position. The *Visibility* field or *Visibility MVField* of the business component determines the visibility.
* **1 (ManagerView)**: +
Displays records that a user and others who report to the user can access. For example, it includes the records that Siebel CRM displays in the My Team's Accounts visibility filter.
* *2 (**PersonalView)**: +
Displays records that a user can access, as determined by the *Visibility Field* property of the *BusComp* view mode object. For example, it includes the records that Siebel CRM displays in the My Accounts visibility filter.
* **3 (AllView)**: +
Displays all records that includes a valid owner. For example, it includes the records that Siebel CRM displays in the All Accounts Across Organizations visibility filter.
|*DataSense Filter Query* |Use this field to write a query to filter the Business Components metadata being downloaded into the application.
[NOTE]
Limit the number of objects to retrieve through DataSense to a few objects using search specifications, otherwise retrieving metadata slows down Studio.
|*DataSense Filters Business Objects:* | (Composed of the two fields below, *Default View Mode* and *DataSense Filter Query*)
|*Default View Mode* a|
Use to set the visibility type for a business component. The supported values are:

* *0 (SalesRepView):* +
** Applies access control according to a single position or a sales team.
** Displays records according to one of the following items: The user position or the sales team that includes the user position. The *Visibility* field or *Visibility MVField* of the business component determines the visibility.
* *1 (ManagerView):* +
Displays records that the user and the others who report to the user can access. For example, it includes the records that Siebel CRM displays in the My Team's Accounts visibility filter.
* *2 (PersonalView):* +
Displays records that the user can access, as determined by the *Visibility Field* property of the *BusComp* view mode object. For example, it includes the records that Siebel CRM displays in the My Accounts visibility filter.
* *3 (AllView)*: +
Displays all records that includes valid owner. For example, it includes the records that Siebel CRM displays in the All Accounts Across Organizations visibility filter.
|*Data Sense Filter Query* |Use this field to write a query to filter the Business Objects metadata being downloaded into the application. +
[NOTE]
Limit the number of objects to retrieve through DataSense to a few objects using search specifications; otherwise retrieving metadata slows down Studio.
.5+|*Required Dependencies* |Click *Add File* to browse to and attach the required JAR files to your project's Build path.

image:siebel-dep.png[siebel-dep]

After the JAR files are attached, they appear in the `lib\siebel` directory of your project's root folder.

image:siebel-green-dep.png[siebel-green-dep]

If you provide the wrong files (either invalid .jar or a completely different library), Studio displays the following error message:

image:siebel-select-dep.png[siebel-select-dep]
|===
+
.. For the Siebel Business Services connector:
+
image:siebel-bs-config.png[siebel-bs-config]
+
[%header,cols="30a,70a"]
|===
|Field |Description
|*RSA Encryption* |Choose if you want to use RSA encryption.
|*Name* |Enter a name for this connector to reference it later.
|*User* |Enter the Siebel username you want to use for this configuration.
|*Password* |Enter the corresponding Siebel password.
|*Server* |Enter the server IP address of your Siebel instance.
|*Port* |Enter the port number.
|*Server Name* |Enter the Siebel Enterprise server name.
|*Object Manager* |Enter the value of the Object Manager of your Siebel instance. This defaults to `EAIObjMgr_enu`.
|*Language* |Enter the language corresponding to the locale of the Siebel instance.
|*Encoding* |Enter an encoding type supported by the Siebel server.
|*Enable DataSense* |This option is selected by default. If you want to disable the option, click the box to clear it.
|*Default View Mode* a|
Default View Mode is 3. It is used to set the visibility type for a business service.

Supported values:

* *0 (SalesRepView):* +
** Applies access control according to a single position or a sales team.
** Displays records according to one of the following items: The user position or the sales team that includes the user position. The *Visibility* field or *Visibility MVField* of the business component determines the visibility.
* **1 (ManagerView)**: +
Displays records that the user and the others who report to the user can access. For example, it includes the records that Siebel CRM displays in the My Team's Accounts visibility filter.
* **2 (PersonalView)**: +
Displays records that the user can access, as determined by the *Visibility Field* property of the *BusComp* view mode object. For example, it includes the records that Siebel CRM displays in the My Accounts visibility filter.
* **3 (AllView)**: +
Displays all records that includes valid owner. For example, it includes the records that Siebel CRM displays in the All Accounts Across Organizations visibility filter.

|*Data Sense Filter Query* a|
Use this field to write a query to filter the Business Services metadata being downloaded into the application.

[NOTE]
Limit the number of objects to retrieve through DataSense to a few objects using search specifications, otherwise retrieving metadata slows down Studio. The Siebel Vanilla installation comes with 8000 predefined objects versus 350 in SFDC.

|*Required Dependencies* a|
Click *Add File* to attach required JAR files to your project's Build path.

image:siebel-dep.png[siebel-dep]

After the JAR files are attached, they appear in the `lib/siebel` directory of your project's root folder.

image:siebel-green-dep.png[siebel-green-dep]

If you provide the wrong files (either invalid JAR files or a completely different library), Studio displays the following error message:

image:siebel-select-dep.png[siebel-select-dep]

|===


.. For the Siebel Integration Objects connector:
+
image:siebel-op-config.png[siebel-op-config]
+
[%header,cols="30,70a"]
|===
|Field |Description
|*RSA Encryption* |Choose if you want to use RSA encryption.
|*Name* |Enter a name for this connector to reference it later.
|*User* |Enter the Siebel username you want to use for this configuration.
|*Password* |Enter the corresponding Siebel password.
|*Server* |Enter the server IP address of your Siebel instance.
|*Port* |Enter the port number.
|*Server Name* |Enter the Siebel Enterprise server name.
|*Object Manager* |Enter the value of the Object Manager of your Siebel instance. This defaults to `EAIObjMgr_enu`.
|*Language* |Enter the language corresponding to the locale of the Siebel instance.
|*Encoding* |Enter an encoding type supported by the Siebel server.
|*Enable DataSense* |This option is selected by default. If you want to disable the option, click the box to clear it.
|*Default View Mode* a|
The default value for this field is 3. It is used to set the visibility type for a integration object.

Supported values:

* *0 (SalesRepView):* +
** Applies access control according to a single position or a sales team.
** Displays records according to one of the following items: The user position or the sales team that includes the user position. The *Visibility* field or *Visibility MVField* of the business component determines the visibility.
* **1 (ManagerView)**: +
Displays records that the user and the others who report to the user can access. For example, it includes the records that Siebel CRM displays in the My Team's Accounts visibility filter.
* **2 (PersonalView)**: +
Displays records that the user can access, as determined by the *Visibility Field* property of the *BusComp* view mode object. For example, it includes the records that Siebel CRM displays in the My Accounts visibility filter.  +
* **3 (AllView)**: +
Displays all records that includes valid owner. For example, it includes the records that Siebel CRM displays in the All Accounts Across Organizations visibility filter.

|*Data Sense Filter Query* a|
Use this field to write a query to filter the Integration Objects metadata being downloaded into the application.

[NOTE]
Limit the number of objects to retrieve through DataSense to a few objects using search specifications; otherwise retrieving metadata slows down Studio. The Siebel Vanilla installation comes with 8000 predefined objects versus 350 in SFDC.

|*Data Sense Flat Fields* a|
Select this box to allow Studio to flatten the object for DataSense purposes.

[NOTE]
Anypoint Studio doesn't support hierarchical objects.

|*Required Dependencies* |Click *Add File* to attach required JAR files to your project's Build path.
image:siebel-dep.png[siebel-dep]

|===

. Keep the *Pooling Profile* and the *Reconnection* tabs with their default entries.
. Click *Test Connection* to confirm that the parameters of your global Siebel connector are accurate, and that Mule is able to successfully connect to your instance of Siebel. Read more about link:/anypoint-studio/v/5/testing-connections[Testing Connections].
. Click *OK* to save the global connector configurations.

== Using the Connector
The Siebel Connector v3.0.0 is  an operation-based connector,
which means that when you add the connector to your flow you must specify an operation to perform.


=== Use Cases
The following are common use cases for the Siebel v3.0.0 connector:

* Poll a Siebel connector at a regular interval for new registries and send the output into Salesforce.
* Poll a Salesforce connector at a regular interval for new registries and send the output into Siebel.

=== Adding the Siebel Connector Business Object Connector 3.0.0 to a Flow
. Create a new Mule project in Anypoint Studio.
. Add a suitable Mule Inbound endpoint, such as the HTTP listener or File endpoint, to begin the flow.
. Drag the Siebel Business Objects connector onto the canvas, then select it to open the properties editor.
. Drag the business objects connector onto the canvas, then select it to open the properties editor.
. Configure the connector's parameters:
+
image:siebel-query.jpg[image]
+
[%header%autowidth.spread]
|=======
|Field |Description
|Display Name |Enter a unique label for the connector
|Connector Configuration |Select a global Siebel  connector element from the dropdown.
|General a|
[NOTE]
The values in the General section vary depending on the operation you choose. The fields below are specific to Query Business Component operation. For a detailed explanation of all the available
|Sort Specification |Specify sorting criteria for the list of business components returned by the query.
|Business Object Component Type|Define the Siebel business object type to act upon. The Siebel Jdb connector can access any one of the many business objects available in the Siebel CRM.
|Search Expression | Use *Mule Expression Language (MEL)* to define a search expression that would return a list of business components.
|View Mode |Define the Siebel view mode for the results the connector returns.
|FieldstoRetrieve |Use this section to specify the list of fields to retrieve in the query:

*From Message:* Specify the Business Component fields to retrieve in the incoming payload.

*Create Object manually*: Specify the fields manually using the Object Builder editor.

|Search Spec |Specify the search values to use as filters in the search query:

*From Message*: Define which values to use as search filters in the incoming payload.

*Create Object manually*: Define which values to use as search filters manually using the Object Builder editor.

|Generic |
|Operation |Define the action this component must perform: create, delete, update, insert, upsert, or query business components

|=======

=== Adding the Siebel Connector Business Service 3.0.0 to a Flow
. Create a new Mule project in Anypoint Studio.
. Add a suitable Mule Inbound endpoint, such as the HTTP listener or File endpoint, to begin the flow.
. Drag the Siebel Business Service connector onto the canvas, then select it to open the properties editor.
. Drag the business Service connector onto the canvas, then select it to open the properties editor.
. Configure the connector's parameters:
+
image:siebel-bs-query.jpg[Connector Parameters, 500]
+
[%header]
|=======
|Field |Description
|Display Name |Enter a unique label for the connector
|Connector Configuration |Select a global Siebel  connector element from the dropdown.
|Operation |Define the action this component must perform: Define the action this component must perform:

*Execute*: Executes a Siebel Service using SiebelPropertySets.

*Execute business service*: Executes a Siebel Service using Maps instead of SiebelPropertySet.
|General |
|=======
+
*If you select the Execute operation:*
+
|=======
|Integration Object|Define the Siebel integration object type to act upon.
|Method Name |Enter the name of the method to be executed.
|ServiceName|Enter the name of the Siebel service to be executed
|Input Properties |*From Message*: Define the SiebelPropertySet in the incoming payload.

*Create Object manually*: Define the SiebelPropertySet manually
|=======
*If you select the Execute business service operation:* +
+
|=======
|Business Service|Define the Siebel integration object type to act upon.
|Input |*From Message*: Specify which service to execute in the incoming payload.


*Create Object manually*: Specify which service to execute manually.

|=======

=== Adding the Siebel Integration Objects Connector 3.0.0 to a Flow
. Create a new Mule project in Anypoint Studio.
. Add a suitable Mule Inbound endpoint, such as the HTTP listener or File endpoint, to begin the flow.
. Drag the Siebel Integration Objects connector onto the canvas, then select it to open the properties editor.
. Configure the connector's parameters:
+
image:siebel-int-io.jpg[Connector Parameters, 500]
+
[%header]
|=======
|Field |Description
|Display Name |Enter a unique label for the connector
|Connector Configuration |Select a global Siebel  connector element from the dropdown.
|Operation | Define the action this component must perform: *Execute Siebel Adapter.*
|General |
|Integration Object |Define the Siebel integration object type to act upon.
|Method|Define the EAI Siebel Adapter method.
|Input Properties |Use this section to specify the list of fields to retrieve in the query:

*From Message:* Map the Integration Object fields from the incoming payload.

*Create Object manually*: Map the Integration Object field manually using the Object Builder editor.


|=======

+
. Click the blank space on the canvas to save your connector configurations.

=== Example Use Case

Poll a Siebel connector at a regular interval, looking for new registries, and send the output into Salesforce.


Refer to documentation on the Poll Scope, DataWeave, and the Salesforce connector for in-depth information about these Mule elements.


image:example-use-case.jpg[Demo Flow, 500]

. Create a Mule project in your Anypoint Studio.
. Drag a *Poll Scope* into a new flow +
image:poll2.jpg[image] +
.  link:/mule-user-guide/v/3.7/poll-reference[Poll Reference] executes any Mule element you place inside it at regular intervals. In this case, it is a Siebel endpoint.
. Configure the Poll Scope as follows
+
image:pollnew.jpg[image]
+
[%header%autowidth.spread]
|===
|*Attribute* |Value
|*Frequency* |60000
|*Start Delay* |0
|*Time Unit* |MILLISECONDS
|*Enable Watermark* |check
|*Variable Name* |lastUpdate
|*Default Expression* |`#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID("PST8PDT")).minusSeconds(5).toString("MM/dd/yyyy HH:mm:ss")]`
|Update Expression |`#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID("PST8PDT")).minusSeconds(5).toString("MM/dd/yyyy HH:mm:ss")]`
|===
+
The poll scope triggers once a minute. The watermark ensures that registries in the Siebel DB aren't processed more than once. It does this by keeping track of the last element processed in the last poll.
+
[NOTE]
To learn how watermarks work and what each attribute is for, read about link:/runtime-manager/managing-schedules[Poll Schedulers].
. Drag an *Oracle Siebel Business Objects* connector into the space provided by the Poll Scope. +
image:poll.jpg[image]  +
+
The Siebel connector is now polled at the intervals you specified in the Poll Scope.
+
. Open Siebel connector's properties editor, and next to the Config Reference field, click the *+* sign to add a new *Global Element.*
+
image:boconfig.jpg[image]

. On the Global Element Properties window, configure the global element according to the settings below:
+
image:config.jpg[image]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Name* |Oracle_Siebel_Business_Object
|*User* |<Your Siebel user name>
|*Password* |<Your Siebel password>
|*Port* |<Port you're using>
|*Server Name* |<Server name on which the Siebel instance is hosted>
|*Object Manager* |<Object manager you use>
|*Default View Mode* |3
|*Data Sense Filter Query* |`[Name] = 'Action_IO' OR [Name] = 'Contact_IO'``
|*Default View Mode* |3
|*Data Sense Filter Query* |`[Name] = 'Action_IO' OR [Name] = 'Contact_IO'``
|===
+
[WARNING]
DataSense is filtered via a query to extract data only from Contacts and Action. This allows for improved performance by avoiding unnecessary data extraction.
+
. Click *Test Connection* at the bottom of the window to ensure that everything is correctly configured.
. Next, configure the Oracle Siebel Business Objects connector according to the settings below:

+
image:boconfig1.jpg[image]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Display Name* |Oracle Siebel business objects
|*Connector Configuration* |Oracle_Siebel_Business_Object
|*Business Object Component Type* |Contact.Contact
|*Search Expression* |`[Last Update - SDQ] > '#[flowVars.lastUpdate]'`
|*View Mode* |3
|*fields-to-retrieve* |Create Object Manually
|*search-spec* |None
|*Operation* |Query business components
|===
+
*Note*: The search expression uses the same variable that is being updated by the Poll Scope. In this way, the Siebel connector returns only those DB records that Mule hasn't processed in the last poll.
+
[%header,cols="2*"]
|===
|Child Element |Description
a|


siebel:fields-to-retrieve


 |Lists the output fields of the query
|===
. To set up the structure of the output message, switch views to the Studio XML Editor. Look for the Siebel connector in your XML code in a tag that looks like the tag below:
+

[source,xml,linenums]
-----
<siebel:query-business-components config-ref="Oracle_Siebel_Business_Object" businessObjectComponentType="Contact.Contact" searchExpression="[Last Update - SDQ] &gt; '#[flowVars.lastUpdate]'" doc:name="oracle siebel business objects">
</siebel:query-business-components>
-----
+
In between the start and end tags of the  `siebel:query-business-components`, add the following child element structure:
+

[source,xml,linenums]
----
<siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Last Name</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Email Address</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>First Name</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Primary Organization</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Personal Contact</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Employee Number</siebel:fields-to-retrieve>
    <siebel:fields-to-retrieve>Account Integration Id</siebel:fields-to-retrieve>
</siebel:fields-to-retrieve>
----

. Drag a *Logger* after the Poll to register the Poll output.

+
image:logger.jpg[image]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Message* |`Polling from Siebel #[payload]`
|*Level* |Info
|===
. Drag a *Salesforce Connector* after the Logger. It uploads the output of the poll into your Salesforce account. +
image:salesforce.jpg[image]

. Open the Properties editor of the Salesforce connector, and click the *+* sign to add a new Salesforce global element. +
 *{{0}}*

. On the Choose Global Type window, click **Salesforce: Basic authentication**, and then click *Ok*.  ** **
+
image:sfbasicauth.jpg[image]
+
. Configure the Salesforce global element properties: +
+
image:Salesconfig.jpg[image]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Name* |Salesforce
|*Username* |<Your user name>
|*Password* |<Your password>
|*Security Token* |<Your Token>
|*Url* |<The URL on which your Salesforce account is hosted>
|*Proxy Port* |80
|*Enable DataSense* |check
|===

. Click *Test Connection* to ensure that everything is correctly configured.
. Configure the Salesforce connector according to the settings below: +
+
image:salesforce2.jpg[image]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Display Name* |Salesforce
|*Connector Configuration* |Salesforce
|*Operation* |Create
|*sObject Type* |contact
|*sObjects* |`From Message:#[payload]`
|===
. Add a *DataWeave* element between the Logger and the Salesforce connector. It maps fields from the data structure returned by Siebel into the data structure required by Salesforce.

. Configure the *DataWeave* element:
+
[TIP]
If you have already configured both connectors properly, DataWeave automatically shows what Siebel is giving as output and what Salesforce is getting as input
+
Input:
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Type* |Connector
|*Connector* |`Oracle_Siebel_Business_Object`
|*Operation* |`query-business-components`
|*Object* |List<Contact.Contact>
|===
+
Output:
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Type* |Connector
|*Connector* |Salesforce
|*Operation* | create
|*Object* | List<Contact>
|===
+
. Add a *Logger* at the end of the flow to register the outcome of the operation: +
+
image:flow2.png[flow2]
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Message* |`#[payload.toString()]`
|*Level* |Info
|===
+
. Save and run the project as a Mule Application.
....
[tab,title="XML Editor"]
....
. At the start of your project, add a Salesforce Global Element to set up global configuration attributes for this connector:
+

[source,xml,linenums]
----
<sfdc:config name="Salesforce" username="${salesforce.user}" password="${salesforce.password}" securityToken="${salesforce.securitytoken}" url="${salesforce.url}" doc:name="Salesforce">
<sfdc:connection-pooling-profile initialisationPolicy="INITIALISE_ONE" exhaustedAction="WHEN_EXHAUSTED_GROW"/>
</sfdc:config>
----

+
[%header%autowidth.spread]
|===
|Element |Description
|`sfdc:config` |Configures connection settings for Salesforce
|===
+
[%header%autowidth.spread]
|===
|Attribute |Value
|`name` |Salesforce
|`username` |<Your username>
|`password` |<Your password>
|`security token` |<Your security token>
|`url` |<The URL on which your Salesforce account is hosted>
|`doc:name` |Salesforce
|===
+
[%header%autowidth.spread]
|===
|Child Element |Description
|`sfdc:connection-pooling-profile` |Configures connection pooling settings for connecting to Salesforce
|===
+
[%header%autowidth.spread]
|===
|Attribute |Value
|`initialisationPolicy` |INITIALISE_ONE
|`exhaustedAction` |WHEN_EXHAUSTED_GROW
|===
. After the Salesforce Global Element, add a *Siebel Global Element* to set up global configuration attributes for this connector:
+

[source,xml,linenums]
----
<siebel:config name="Oracle_Siebel_Business_Object" user="${siebel.user}" password="${siebel.password}" server="${siebel.server}" serverName="${siebel.servername}" objectManager="${siebel.mgr}" dataSenseFilterQueryBusComp="[Name] = 'Action_IO' OR [Name] = 'Contact_IO'" dataSenseFilterQueryBusObjects="[Name] = 'Action_IO' OR [Name] = 'Contact_IO'" doc:name="oracle siebel business objects">
       <siebel:connection-pooling-profile initialisationPolicy="INITIALISE_ONE" exhaustedAction="WHEN_EXHAUSTED_GROW"/>
    </siebel:config>
----
+
[%header%autowidth.spread]
|===
|Element |Description
|`siebel:config` | Configures connection settings for Siebel
|===
+
[%header,cols="2*"]
|===
|Attribute |Value
a|

`name`
 a|
`Oracle_Siebel_Business_Object`

a|

`user`

|<Your user name>

a|

`password`


 |<Your password>

a|

`server`

 |<The IP address of your Siebel server>
a|
`server`

|<The Siebel Enterprise server name>

a|

`objectManager`

|<The object manager you use>
a|

`dataSenseFilterQueryBusComp`


 a|
`[Name] = 'Action_IO' OR [Name] = 'Contact_IO'`

a|
`dataSenseFilterQueryBusObjects`


 a|

`[Name] = 'Action_IO' OR [Name] = 'Contact_IO'`

a|

`doc:name`

 a|

`oracle siebel business objects`

|===
+
[%header%autowidth.spread]
|===
|Child Element |Description
|`siebel:connection-pooling-profile` | Configures connection pooling settings for connecting to Siebel
|===
+
[%header,cols="2*"]
|===
|Attribute |Value
a|

`initialisationPolicy`

| INITIALISE_ONE
a|

`exhaustedAction`

|WHEN_EXHAUSTED_GROW
|===
. Build a new **Flow:**
+

[source,xml,linenums]
----
<flow name="Poll_Siebel_2_Salesforce" doc:name="Poll_Siebel_2_Salesforce" processingStrategy="synchronous">
    </flow>
----

. Add a *Poll Scope* inside your new Flow.
+

[source,xml,linenums]
----
<poll doc:name="Poll">
    <fixed-frequency-scheduler frequency="60000"/>
    <watermark variable="lastUpdate" default-expression="#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH:mm:ss&quot;)]" update-expression="#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH:mm:ss&quot;)]"/>
</poll>
----

+
[%header%autowidth.spread]
|===
|Element |Description
|`poll` |A Poll Scope executes the Mule element you place inside it at regular intervals. In this case, it will be a Siebel endpoint.
|===
+
[%header,cols="2*"]
|===
|Child Element |Description
|`fixed-frequency-scheduler` |Sets the interval for polling
|===
+
[%header,cols="2*"]
|===
|Attribute |Value
a|frequency |6000
|===
+
The poll scope triggers once a minute. The watermark ensures that registries in the Siebel DB aren't processed more than once. It does so by keeping track of  the last element processed in the last poll.
+
[%header,cols="2*"]
|===
|Child Element |Description
a|`watermark`
|The watermark ensures that registries in the Siebel DB aren't processed more than once by keeping track of what was the last element that was processed in the last poll.
|===
+
[NOTE]
To learn how watermarks work and what each attribute is for, read about link:/runtime-manager/managing-schedules[Poll Schedulers].
+
[%header,cols="2*"]
|===
|Attribute |Value
a|`variable`
|lastUpdate
|`default-expression` |`#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH: mm:ss&quot ;)]`
|`update-expression` |`#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH:mm:ss&quot;)]`
|===
. Inside this Poll Scope, add a **Siebel:query-business-components** element
+

[source,xml,linenums]
----
<siebel:query-business-components config-ref="Oracle_Siebel_Business_Object" businessObjectComponentType="Contact.Contact" searchExpression="[Last Update - SDQ] &gt; '#[flowVars.lastUpdate]'" doc:name="oracle siebel business objects">
    <siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Last Name</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Email Address</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>First Name</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Primary Organization</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Personal Contact</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Employee Number</siebel:fields-to-retrieve>
        <siebel:fields-to-retrieve>Account Integration Id</siebel:fields-to-retrieve>
    </siebel:fields-to-retrieve>
</siebel:query-business-components>
----

+
The Siebel connector polls at the intervals you specified in the Poll Scope:
+
[%header,cols="2*"]
|===
|Element |Description
a|`siebel:query-business-components`
|Connects to Siebel Business Components
|===
+
[%header,cols="2*"]
|===
|Attribute |Value
a|`config-ref`
a|`Oracle_Siebel_Business_Object`
a|`businessObjectComponentType`
a|`Contact.Contact`
a|`searchExpression`
a|``[Last Update - SDQ] &gt; '#[flowVars.lastUpdate]``
a|`doc:name`
a|`oracle siebel business objects`
|===
+
[%header,cols="2*"]
|===
|Child Element |Description
a|`siebel:fields-to-retrieve`|Lists the output fields of the query
|===

. After the Poll Scope, add a Logger to verify the output of this poll:
+

[source,xml,linenums]
----
<logger message="Polling from Siebel #[payload]" level="INFO" doc:name="Logger"/>
----

+
[%header%autowidth.spread]
|===
|Element |Description
|`logger` |Logs messages to the Mule console
|===
+
[%header%autowidth.spread]
|===
|Attribute |Value
|`message` |`Polling from Siebel #[payload]`
|`level` |Info
|===

. Add a Salesforce connector after this logger. It uploads the output of the poll into your Salesforce account.
+

[source]
----
<sfdc:create config-ref="Salesforce" type="Contact" doc:name="Salesforce">
    <sfdc:objects ref="#[payload]"/>
</sfdc:create>
----

+
[%header,cols="2*"]
|===
|Element |Description
a|`sfdc:create`|Creates a contact entry on the specified Salesforce account
|===
+
[%header,cols="2*"]
|===
|Attribute |Values
a|`config-ref`
|Salesforce
a|`type`
|Contact
a|`doc:name`
|Salesforce
|===
+
[%header,cols="2*"]
|===
|Child Element |Description
a|`sfdc:objects`
|Defines what structure the created object will have
|===
+
[%header,cols="2*"]
|===
|Attribute |Values
a|`ref` a|`#[payload]`
|===
. Add another logger after the Salesforce connector to verify the success of the operation.
+

[source,xml,linenums]
----
<logger message="#[payload.toString()]" level="INFO" doc:name="Logger"/>
----

+
[%header%autowidth.spread]
|===
|Element |Description
|`logger` |Logs messages to the Mule console
|===
+
[%header%autowidth.spread]
|===
|Attribute |Value
|`message` |`#[payload.toString()]`
|`level` |Info
|===
. Add a *DataWeave* *component* between the first logger and the Salesforce connector. It maps fields from the data structure returned by Siebel into the data structure required by Salesforce
+

[source,xml]
----
<data-mapper:transform doc:name="DataWeave"/>
----

. Switch to Studio Visual editor to configure DataWeave correctly. Click on the DataWeave icon to edit its fields:
+
[TIP]
If you have already configured both connectors properly, DataWeave should be able to automatically suggest the mapping you need to make.
+
Input:
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Type* |Connector
|*Connector* |Oracle_Siebel_Business_Object
|*Operation* |`query-business-components`
|*Object* |`List<Contact.Contact>`
|===
+
Output:
+
[%header%autowidth.spread]
|===
|Attribute |Value
|*Type* |Connector
|*Connector* |Salesforce
|*Operation* |create
|*Object* |`List<Contact>`
|===
. Click *Create mapping* for DataWeave to build a mapping between both data structures.
. A few fields don't have the same names in Salesforce as they do in Siebel. You must configure them manually.
+
[%header%autowidth.spread]
|===
|Name in Siebel |Name in Salesforce
|Email_Address |Email
|First_Name |FirstName
|Last_Name |LastName
|===
+
There are two ways in which you can link these:

.. Look for the fields on both columns in** DataLoader's graphical view**, then simply drag and drop one onto the other.
+
[cols="2*"]
|===
|
|This is usually the easiest way to go, but given the number of fields to navigate, it may be hard to find the fields you need. Use the search box above the field list to find these quickly.

|===
.. Enter **DataLoader's Script view** and paste the following lines of code below what is already written:
+
[source]
----
output.Email = input.Email_Address;
output.FirstName = input.First_Name;
output.LastName = input.Last_Name;
----
+

The full code should look like this:
+

[source]
----
//MEL
//START -> DO NOT REMOVE
output.__id = input.__id;
//END -> DO NOT REMOVE
output.Department = input.Department;
output.Email = input.Email_Address;
output.First_Name = input.First_Name;
output.LastName = input.Last_Name;
----

. Save and run the project as a Mule Application.
....
------

== 示例代码

注意：要使用示例代码在Anypoint Studio中工作，您必须为Siebel和Salesforce帐户提供凭据。您可以使用代码中的值替换变量，也可以在src / main / properties文件夹中添加名为mule.properties的文件，以为每个变量提供值。

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:context="http://www.springframework.org/schema/context"
	xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:siebel="http://www.mulesoft.org/schema/mule/siebel" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:data-mapper="http://www.mulesoft.org/schema/mule/ee/data-mapper" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" version="EE-3.7.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-current.xsd http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/siebel http://www.mulesoft.org/schema/mule/siebel/current/mule-siebel.xsd
http://www.mulesoft.org/schema/mule/ee/data-mapper http://www.mulesoft.org/schema/mule/ee/data-mapper/current/mule-data-mapper.xsd">

   <siebel:config name="Oracle_Siebel_Business_Object" user="${siebel.user}" password="${siebel.password}" server="${siebel.server}" serverName="${siebel.servername}" objectManager="${siebel.mgr}" dataSenseFilterQueryBusComp="[Name] = 'Action' OR [Name] = 'Contact'" dataSenseFilterQueryBusObjects="[Name] = 'Action' OR [Name] = 'Contact'" doc:name="oracle siebel business objects">
        <siebel:connection-pooling-profile initialisationPolicy="INITIALISE_ONE" exhaustedAction="WHEN_EXHAUSTED_GROW"/>
    </siebel:config>
    <context:property-placeholder location="mule.properties"/>
    <flow name="siebel2salesforce" >
        <poll doc:name="Poll">
            <fixed-frequency-scheduler frequency="60000"/>
            <watermark variable="lastUpdate" default-expression="#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH:mm:ss&quot;)]" update-expression="#[new org.joda.time.DateTime().withZone(org.joda.time.DateTimeZone.forID(&quot;PST8PDT&quot;)).minusSeconds(5).toString(&quot;MM/dd/yyyy HH:mm:ss&quot;)]"/>
            <siebel:query-business-components config-ref="Oracle_Siebel_Business_Object" businessObjectComponentType="Contact.Contact" searchExpression="[Last Update - SDQ] &gt; '#[flowVars.lastUpdate]'" doc:name="oracle siebel business objects">
                <siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Last Name</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Email Address</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>First Name</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Primary Organization</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Personal Contact</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Employee Number</siebel:fields-to-retrieve>
                    <siebel:fields-to-retrieve>Account Integration Id</siebel:fields-to-retrieve>
                </siebel:fields-to-retrieve>
            </siebel:query-business-components>
        </poll>
        <logger message="Polling from Siebel #[payload]" level="INFO" doc:name="Logger"/>
        <dw:transform-message doc:name="Transform Message">
            <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
  "SiebelMessage":payload.SiebelMessage
}]]></dw:set-payload>
        </dw:transform-message>

        <sfdc:create config-ref="Salesforce" type="Contact" doc:name="Salesforce">
            <sfdc:objects ref="#[payload]"/>
        </sfdc:create>
        <logger message="#[payload.toString()]" level="INFO" doc:name="Logger"/>
    </flow>
</mule>

----
== 另请参阅

* 详细了解如何使用 link:/mule-user-guide/v/3.7/anypoint-connectors[Anypoint连接器]。
* 了解如何使用 link:/mule-user-guide/v/3.7/mule-transformers[骡变形金刚]。
