= 关于Anypoint MQ
：imagesdir：./_images

Anypoint MQ是企业多租户云消息服务，可在应用程序之间执行高级异步消息传递方案。 Anypoint MQ与Anypoint Platform完全集成，提供基于角色的访问控制，客户端应用程序管理和连接器。

Anypoint MQ支持混合使用案例，从不同设备收集数据的IoT以及可用于设备应用程序的REST API。您还可以将Anypoint MQ与其他应用程序框架（如node.js）一起使用，以便与队列进行通信。

任意点MQ：

* 在云中提供完全托管和管理的队列和消息交换。队列是临时存储区域。消息交换绑定一个或多个队列，以便发送到消息交换的消息同时出现在所有绑定队列中。
*  MQ构建于Anypoint平台上，这意味着队列和消息交换提供了与平台本身相同的管理功能，从环境和业务部门为基于多租户角色的访问控制到客户端访问管理提供了相同的管理功能。
* 支持大量的有效载荷，加密，排队，发布 - 子范例。
*  REST API允许您轻松地与非Mule应用程序进行交互。
* 提供Studio访问权限，这使得您的队列和消息交换过程像拖放，配置一样简单。
* 显示消息和API请求数量的使用情况统计信息，以便管理峰值使用率和订阅参数。
* 为无法投递的邮件提供死信队列功能。

== 特点

Anypoint MQ包含以下功能：

* 队列和消息交换：将消息发送到队列，从队列中提取消息，创建消息交换以执行发布/订阅方案并将消息发送到多个队列。
* 管理控制台：监控队列统计信息，清除队列，并通过管理控制台查看有多少消息正在运行。
*  Anypoint MQ连接器：发送和接收来自任何Mule应用程序的消息，无论它是部署在CloudHub中还是用于混合场景并部署在本地。
{1}}使用信息：组织管理员或所有者可以查看当前和过去的月份使用情况 - 消息和API请求的总数。该信息可从访问管理页面访问。有关更多信息，请参阅 link:/anypoint-mq/mq-usage[Anypoint MQ使用信息]。
*  REST API：使用REST API轻松与非Mule应用程序通信。
* 环境和基于角色的访问控制：Anypoint MQ与Anypoint Access Management完全集成，允许您为队列指定不同的环境，可以访问每个环境的人员以及他们可以在每个环境中执行的操作。
* 客户端管理：创建客户端应用程序令牌。
* 大型有效载荷：Anypoint MQ支持最大10 MB的有效载荷。
* 灾难恢复：在每个区域内，MQ服务部署到多个可用区（AZ）以提供高可用性（HA）。如果一个可用区域中的服务出现故障，则Anypoint MQ服务在该区域中正常运行。如果所有可用区域在某个区域中停止运行，则该区域中的MQ服务将不可用，直到至少有一个可用区域恢复运行。但是，MQ的存储解决方案非常耐用，这意味着在服务被中断之前，MQ系统中已经存在的消息不会丢失任何消息。
* 加密队列：可以选择加密队列数据，以确保公司可以在休息策略中遵从其数据。 Anypoint MQ使用带有MD5和DES的PBE来加密消息。

== 队列

消息队列提供临时存储，允许应用程序以可扩展和可靠的方式进行通信。发布者可以将消息发布到队列中，并且订阅者可以从队列中接收消息。可以设置死信队列来存储无法传送的消息。

image:mq-pub-q-sub.png[MQ发布者 - 队列订阅者]

队列提供了许多好处：

* 水平可伸缩性：通过在队列中放置消息，处理该消息的工作可以分布到多个不同的订户。
* 可靠性：队列确保始终处理消息，即使在出现故障的情况下也是如此。
+
在Anypoint MQ中，通过锁和 link:/anypoint-mq/mq-ack-mode[承认机制]通过队列提供可靠性。这确保了即使在出现故障的情况下也始终处理消息。
+
* 解耦：队列可用作不同应用程序和设备之间的通信机制，允许它们具有不同的开发生命周期或维护时段，而不影响其他应用程序。
* 聚合：当有很多消息生成器时，它们都可以发布到单个队列中，以便消费者轻松使用。
* 消费者从队列中检索消息。这将锁定消息，并使消息对所有其他消费者不可见。
* 检索时，使用者指定锁超时。如果该消息在该时间窗口内未被处理，该消息使其他消费者可见并被处理。这可以确保如果某种类型的故障（如消费者节点崩溃）发生故障，则可以由另一个节点处理消息。锁定的消息不会阻止其他消息被读取。该锁使锁定时其他应用程序无法使用消息。
* 如果消费者成功处理消息，则客户端会确认消息，并且MQ将消息从队列中删除。有关Anypoint MQ如何处理已确认消息的更多信息，请参阅 link:/anypoint-mq/mq-ack-mode[确认模式]。
* 如果消费者无法处理消息，则消息继续进行否定确认，并再次在队列中可见。
* 每个队列都有一个消息生存时间（TTL）。这指定了在MQ过期消息并将其从队列中删除之前消息在队列上的时间。
* 队列中的邮件限制为每个邮件10 MB。但是，可以在队列中显示的消息数量没有限制。
* 通过长轮询读取消息，其中服务器持有一个请求，直到新数据可用。 Anypoint MQ通过一次读取提供一批消息。
*  Anypoint MQ的计费和计费取决于从队列传递给订户的消息数量，并且与您创建的队列或消息交换数量无关。

== 客户端

在Anypoint MQ中，每个消费者都需要注册为客户端。客户有一个名字，ID和一个秘密。客户端使用ID和秘密进行身份验证并获得发布和订阅队列的权限。客户仅适用于单一环境。

客户端应用程序允许访问一组环境中的一组队列和消息交换。它们不能用于多个环境或业务组。

== 消息交换

消息交换提供了一种将消息分发给许多消费者的方法。

image:mq-pub-ex-sub.png[MQ-PUB-EX-SUB]

例如，如果您有发布天气变化的发布者，并且您有多个应用程序都希望接收该数据，则可以使用消息交换将单个消息发布到每个应用程序的多个队列。绑定是队列和消息交换之间的关系，它告诉消息交换将消息发送到哪里。队列可以绑定到多个消息交换。

== 示例

Anypoint MQ的一个例子是运行Salesforce客户关系管理器（CRM）的应用程序想要与处理不同数据库的两个应用程序通信的地方。

image:mq-crm-to-dbs.png[CRM将msg发送给应用程序接收的MQ]

使用Anypoint MQ，Salesforce应用程序将发布/订阅消息发送到消息交换，并且这两个应用程序从消息交换中接收消息并将消息传递到它们各自的数据库。

== 词汇

* 确认/确认：确认 - 应用程序收到消息并且MQ删除消息。有关更多信息，请参阅 link:/anypoint-mq/mq-ack-mode[确认模式]。
Nack  - 应用程序不会收到消息，并且MQ不会删除该消息。
* 绑定 - 允许发布/订阅应用程序桥接简单的发布/订阅结构，并利用点对点功能，例如向特定应用程序发送消息。绑定标识哪些队列包含消息交换。在Anypoint平台中，通过指定消息交换中的哪些消息队列，Anypoint MQ为您创建并管理绑定。
* 死信队列 - 存储来自其他队列的无法传递的消息的队列。
死信队列确保将无法成功传递的消息发送到已知用于备份的队列。死信队列使得能够旁路并隔离未成功处理的消息。然后，用户可以分析发送给DLQ的消息，并确定这些消息未成功处理的原因。 DLQ与其他任何队列几乎相同 - 它只是一个接收未传送消息的队列。
* 目标 - 消息交换或队列。应用程序注册到目标并将消息发布到目标。应用程序订阅目标以接收消息。 Anypoint Platform的MQ功能允许您通过创建或维护队列或消息交换来配置目标。 Anypoint Studio允许您使用Anypoint MQ连接器配置目标。
* 持久消息 - 一直持续到指示的客户端收到消息为止的消息。
* 正在进行中 - 正在等待ack或nack的消息，或过期的锁定生存时间设置。飞行中的消息对其他消费者不可见。 Anypoint MQ每个队列最多支持120,000个飞行消息。消息可以在飞行中持续长达2周，之后超过2周的消息将被删除。先进先出队列最多可以有10个航班信息
每个队列。
队列中的*   - 已发送的消息。
* 锁定ID  - 允许应用程序独占读取队列的锁定。 Anypoint MQ在应用程序从队列中检查消息时提供锁定。锁定的消息不会阻止其他消息被读取。该锁使锁定时其他应用程序无法使用消息。
* 消息 - 应用程序发送和接收的序列化 link:/mule-user-guide/v/3.9/mule-message-structure[骡信息]内容，以便应用程序可以相互通信。
* 消息交换 - 包含多个输出的发布/订阅消息源。应用程序注册以订阅消息交换发布的消息。
* 处所 - 在组织中的计算机上运行的Mule运行时。
* 点对点 - 一种模式，它允许应用程序发送只有单个应用程序可以接收的消息。
*  Pub / sub（发布/订阅） - 一种允许将消息分发给多个消费者的模式。
* 发布者 - 将消息发送到Anypoint MQ的应用程序。
* 队列 - 存储客户端收到的消息的点对点消息存储区。
* 订阅者 - 从Anypoint MQ接收消息的应用程序。
* 使用情况 - 查看指示消耗了多少数据和API请求的图表。

== 另请参阅

*  link:/anypoint-mq[Anypoint MQ]

