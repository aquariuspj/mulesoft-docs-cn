= 使用脚本自动执行任务
:keywords: mmc, automation

*  <<Creating a Script>>
*  <<Saving a New Script>>
*  <<Installing a Script to Run on Startup>>
*  <<Modifying and Deleting a Script>>
*  <<Testing a Script>>
*  <<Scheduling a Script>>
*  <<Cron Command Syntax>>

使用Admin shell编写脚本，您可以轻松地为管理控制台构建和安装自己的扩展。一旦编写完成，您可以安装脚本（即设置脚本在启动时运行）或使用类似cron的调度机制来安排脚本。脚本是使用Groovy脚本语言编写的，该语言类似于Java编程语言。有关Groovy的更多信息，请参阅 link:http://groovy-lang.org/[时髦的语言参考]。

该窗格显示编辑框右侧的所有保存的脚本。默认情况下，管理控制台包含一个脚本，用于查找所有查找未注册的Mule ESB实例的服务器。您应该在“保存的脚本”区域中看到此脚本。你不需要修改这个脚本。您创建并保存的任何其他脚本都会显示在此区域中。

== 创建脚本

要创建脚本，请单击“管理”选项卡，然后单击“实用程序”以展开其选项。点击实用程序选项*Admin Shell*。您可以在窗格中间的空白框中输入脚本。 （请参见下图。）根据屏幕大小，可能需要向下滚动以查看脚本编辑框底部的功能按钮（例如评估，重置，另存为等）。

image:script1.png[SCRIPT1]

例如，您可以输入（或粘贴）以下脚本：

[source, code, linenums]
----
println "Hello"
----

== 保存新脚本

要保存新脚本，请选中另存为框并输入脚本的唯一名称。一旦选中“另存为”框，控制台就不会让您保存脚本，直到您为其输入名称。 （请参见下图。）然后，单击保存。

image:script2.png[SCRIPT2]

== 安装脚本以在启动时运行

要在管理控制台启动时运行脚本，请选择以前保存的脚本或将新脚本输入到编辑框中。然后，检查*Run on startup*框。单击保存以保存并安装脚本。

== 修改和删除脚本

您可以使用现有脚本作为新脚本的模板。点击屏幕右侧的现有脚本，进行修改，然后检查*Save As*。输入脚本的新名称，然后单击保存。这与保存新脚本相同。

您也可以修改现有的脚本并使用相同的名称进行保存。从“保存的脚本”列表中单击现有脚本。进行修改。完成后，点击保存。您对脚本的更改将保存为相同的名称。确保当您想要更改覆盖现有脚本时，不要单击另存为。

您随时可以点击*Reset*返回上一次保存的脚本版本。

要删除脚本，请从屏幕右侧的“保存的脚本”列表中选择该脚本，然后单击*Delete*。

== 测试脚本

单击评估按钮以运行新的或修改的脚本的测试。如果脚本运行时没有错误，则可以将其保存，并且如果需要，可以将其安排为按计划作业运行或安装它以在启动时运行。如果脚本评估失败，则会在页面顶部弹出错误消息。

请注意，使用评估功能不会保存，计划或安装脚本。它只是测试脚本代码的正确性。

== 计划脚本

您可以使用调度程序定期运行脚本，这对复制等作业很有用。

=== 创建预定作业

. 在管理选项卡上，点击实用工具，然后点击*Scheduler*。您应该看到一个列出所有预定脚本的窗格。
+
image:schedule1.png[schedule1]

. 点击*New*打开“添加计划项目”窗格，为脚本设置新的计划。
. 从脚本下拉列表中选择要运行的脚本。 （见下文。）
. 输入此计划作业的唯一名称和说明。
. 输入<<Cron Command Syntax>>指定脚本何时运行。
. 即使脚本的最后一次执行仍在运行，为了允许运行此脚本，请单击*Allow Concurrent Execution*。
. 点击*Save*。
+
image:schedule2.png[了schedule2]
+
[CAUTION]
单击*Save*保存计划作业后，脚本将按指定的计划运行，直到您删除作业。

=== 删除预定作业

. 点击管理标签上的*Scheduler*。
. 单击您想要删除的计划作业。
. 点击*Delete*，然后点击*OK*以确认您要删除此作业。

==  Cron命令语法

指定cron命令时使用以下语法：

[%header,cols="4*"]
|===
|字段名称 |强制性 |允许的值 |允许的特殊字符
|秒 |是 | 0-59  |， -  * /
|分钟 |是 | 0-59  |， -  * /
|小时数 |是 | 0-23  |， -  * /
|每月的某天 |是 | 0-31  |， -  * / L W
|月 |是 | 1-12或JAN-DEC  |， -  * /
|星期几 |是 | 1-7或SUN-SAT  |， -  * / L＃
|年份 |否 |为空，1970-2099  |， -  * /
|===

以下是对特殊字符的描述：

[%header%autowidth.spread]
|===
| {字符{1}}说明
|， |分隔各个值，例如分钟位置的0,30，以在小时和半小时内运行作业。
|  -   |指定一系列值，例如Day Of Week中的MON-FRI位置以在工作周的每一天运行作业。
在星期几位置指定| * |Specifies all values for that position, such as every day of the week when *。
|？ |跳过设置该位置的值。由于星期几和月份的日期是互斥的，请务必使用？在其中一个字段中指定*或另一个的特定值。
| /  |指定增量，例如，当在秒位置指定1/15时，从每分钟的第一秒开始每隔15秒。
| L  |根据位置指定月份或星期的最后一天。
| W  |指定最接近指定日期的工作日，例如在星期几位置指定3W的月份的最靠近月份的第三个工作日运行作业。
|＃{ |指定一个星期中的某一天发生的月份，例如在每周的第二个星期五运行作业，方法是在Day of Week位置指定6＃2（其中6是一周的第六天或星期五，＃2指定当月的第二天）。
|===

以下是一些cron命令的例子：

[%header%autowidth.spread]
|===
| {命令{1}}说明
| 0 0 12 * *？ |每天12点（中午）。请注意，没有指定年份，因为年份的位置是可选的。
| 0 15 10？ * * +
0 15 10 * *？ +
0 15 10 * *？ * +
0 15 10 * *？ ？ |这些命令中的任何一个都在每天上午10点15分执行作业
| 0 0/5 14 * *？ |每5分钟从下午2点开始，结束于下午2点55分，每天
| 0 0/5 14,18 * *？ |每5分钟从下午2点开始，结束于下午2点55分，每5分钟从6点开始到6点结束： 55pm，每天
| 0 0/5 14-16 * *？ |每5分钟从下午2点开始，结束于下午4点55分，每天
| 0 10,44 14？ 3月3日每周三下午2点10分和下午2点44分 |
| 0 15 10？ * 2010年6月2010年 | 2010年，2011年和2012年每月最后一个星期五上午10:15
|===

== 另请参阅

*  link:/mule-management-console/v/3.4/working-with-logs[使用日志]

*  link:/mule-management-console/v/3.4/scripting-examples[*脚本示例*]
