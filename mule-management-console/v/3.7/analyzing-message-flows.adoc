= 分析消息流
:keywords: mmc, flow processing, debug, payload, monitoring

*  <<Define Selection Parameters>>
*  <<Start Data Collection>>
*  <<Control Data Collection>>
*  <<Search the Message List>>
*  <<Get Details About a Message>>
*  <<Understanding the Message Processors and Message Content>>

验证后（通过“流程”选项卡），切换到“流量分析器”选项卡，表明您的应用程序进程正在运行并识别可能的问题。

“流量分析器”选项卡使您能够查看许多问题的原因，并让您了解如何解决这些问题。 （确保要分析的流程已启动并正在运行，如果需要启动特定流程，请使用“流量”选项卡中的“控制流量”按钮。有关“流量”选项卡的更多信息，请参阅 link:/mule-management-console/v/3.7/tracking-flows[跟踪流量]。

[WARNING]
流分析不适用于群集。它主要是一个开发时间工具。但是，您可以在运行您计划部署到群集的应用程序的独立服务器上使用它。

系统管理员和开发人员都会发现流量分析器屏幕对诊断问题（如内存和性能瓶颈）特别有用。您可以使用“流量分析器”选项卡来验证流量的消息负载内容和消息属性。您可以看到消息所需的处理路径，每个处理步骤的消息负载以及调试流程性能。

特别是开发人员会发现，在消息处理的每个点上深入研究有效内容是非常有用的。他们不仅可以查看有效负载是否按照预期进行，而且还可以查看处理中每个点的关联消息属性。此外，在调试应用程序时，如果开发人员需要查看特定类型消息的完整负载，则可以选择关闭加密或使用其他特殊转换工具来解密消息。

本主题将向您介绍使用“流量分析器”选项卡的基本步骤。简而言之，你：

* 为流定义选择参数 - 选择要跟踪或审计的服务器，应用程序和流。
* 开始数据收集过程
* 控制数据收集 - 使用暂停/继续和清除按钮来控制流信息的收集。
* 搜索消息列表 - 查找感兴趣的特定消息。
* 选择一个消息ID以获取详细信息 - 查看消息详细信息。
* 检查消息内容并浏览消息处理器 - 了解消息内容的关键以及如何浏览它们。

== 定义选择参数

在分析流的消息负载之前，您需要定义流选择参数。您在应用程序中选择服务器，应用程序和流程，然后明确开始收集消息处理数据。当您单击“开始”按钮时，管理控制台将开始收集数据，并累积有关在应用程序流中传递的消息负载的信息。即使数据收集继续，您也可以检查消息有效负载。在任何时候，您都可以暂停或停止收集过程，或者清除收集的统计信息，以便从一张干净的版面开始。

假设你想仔细看看你在服务器上部署的hello world示例应用程序。您已验证应用程序流已启动。单击“流量分析器”选项卡并在左窗格中定义参数。首先从下拉列表中选择服务器。选择服务器后，该窗格展开并显示服务器上运行的所有应用程序。点击要跟踪的应用程序，然后“流”部分展开并显示所有适用的流程。您可以选择所有流量或单个流量。下图显示了在进行选择序列时窗格如何变化。

image:define-audit.png[定义审计]

== 开始数据收集

当所有选择都完成时（服务器，应用程序，流程），请确保单击不再变灰的“开始”按钮，以开始收集消息数据以进行分析。

一旦开始数据收集，选择窗格将显示当前正在跟踪的流的列表。中心的“消息列表”面板显示一张表，其中列出了按处理顺序标识每个消息有效负载的标识和摘要信息。

image:audit-list.png[审计清单]

== 控制数据收集

在任何时候，您都可以单击“暂停”按钮并暂停跟踪（即暂停收集消息处理数据）。当您为调试目的收集了足够数量的数据时，您可能会这样做。当您暂停数据收集时，暂停按钮变为继续。随时点击继续以恢复从暂停状态收集数据。跟踪恢复时，处理的消息将添加到先前收集的消息列表的末尾。

点击停止按钮以完全停止跟踪过程。完成特定跟踪会话后，请使用“停止”按钮。您可以使用不同的参数启动新的数据收集，也可以使用先前输入的参数重新启动收集。但是，与暂停状态恢复不同，先前收集的消息不再可用。

点击清除按钮清除消息列表中的消息。数据收集继续进行，没有停顿，新消息被添加到列表中。

== 搜索消息列表

很可能，您正在审核的应用程序将有大量的消息。使用搜索框过滤消息列表并将显示范围缩小为感兴趣的消息。开始在搜索框中输入过滤器字符串，并且更改消息列表以仅显示匹配的消息。清除您输入的内容，然后显示屏再次列出所有消息。

下图说明了将消息列表显示缩小到符合"hello"的流程。

image:audit-search.png[审计搜索]

== 获取有关消息的详细信息

要获取有关消息的详细信息，请单击表中的特定消息负载。消息流部分（位于屏幕下半部分的消息详细信息部分）显示该消息的消息处理器。

image:msg-details1.png[MSG-点评详情]

从消息处理器列表中选择一个消息处理器。其他消息详细信息窗格显示详细信息。例如，点击列表中的消息后，这些窗格将显示与所选消息有关的数据：

image:msg-details2.png[MSG-details2]

== 了解消息处理器和消息内容

消息详细信息窗格为您提供有关消息处理器，消息负载数据和消息属性的详细信息。这些窗格与“消息流”窗格中选定的消息处理器同步。每个详细信息窗格都可以展开，使查看窗格中的所有数据变得更加容易。

“消息流”窗格显示在消息移动通过系统时对消息执行操作的消息处理器。

您将消息流详细信息窗格与其他消息详细信息窗格结合使用来浏览消息处理器。当您单击消息处理器列表中的处理器时，两个有效负载和消息属性窗格将与选定的处理器同步。这使您可以检查所选处理器在负载内容之前和之后的内容，并查看其三种类型的消息属性。

例如，下图显示了突出显示的处理器之前和之后的有效负载以及扩展的入站属性文件夹。

image:details-1.png[详细信息 -  1]

下图显示了在突出显示不同处理器时的有效负载和消息属性之前和之后的不同情况。

image:details-2.png[细节-2]

=== 消息处理器

应用程序使用消息处理器来控制消息流;也就是说，要控制消息在流中的发送和接收方式。

查看前面图中的消息处理器列表，注意ChoiceRouter消息处理器。 ChoiceRouter是标准Choice路由器的实现。它的功能是向第一个匹配的消息处理器发送消息。 MessageFilter也是标准的Idempotent Message Filter的实现，它使用消息ID过滤出重复的消息。

=== 有效载荷数据中有什么

有效载荷数据显示消息的业务相关内容。例如，对于订单输入应用程序，消息有效载荷可能是产品编号或实际销售订单。对于简单的hello world应用程序，有效载荷是通过浏览器输入的个人的名称。

消息有效载荷面板有两部分：有效载荷和有效载荷之前。 Before Payload窗格显示处理器节点收到消息时的消息内容，当消息退出节点时，After Payload窗格显示有效负载。有效载荷数据表明如何应用变换。您需要仔细查看有效负载数据，以确保应用程序转换工作正常。

如前所述，出于安全原因，消息数据可能被加密。虽然在生产中不可能，但在开发的调试阶段，可以访问敏感或加密的消息数据。例如，有效载荷可以是流式数据，它是不可读的，或者是对象数据。您可以通过临时关闭加密，使用对象到字节阵列转换器或使用其他第三方转换器或解密工具来读取流式或加密数据。

有关读取基于流的有效内容（例如CXF流）的更多信息，请参阅 link:/mule-management-console/v/3.7/analyzing-flow-processing-and-payloads[分析流量处理和有效载荷]主题中的"Viewing Message Payload When Using Streams"部分中的如何应用对象到字节数组流转换器。

=== 消息属性

消息属性窗格包含三组消息属性：入站，调用和出站属性。这些消息属性是部分用于控制通过系统的消息流的元数据。这些消息属性还决定了消息路由，终点调用等等。

下图是消息属性元数据的一个例子。 （请注意，某些属性已从图中删除。）消息的属性因具体配置而异。

image:properties.png[性能]

您需要查看消息属性来诊断路由问题和潜在的第三方问题，例如端点未正确调用。
