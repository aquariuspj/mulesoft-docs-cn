= 设置警报目标和通知

警报目标是触发警报时通知发送到的位置，例如电子邮件地址。您需要在创建任何警报通知之前设置警报目标，因为通知与特定目标相关联。设置通知在本节中介绍。

== 设置警报目标

单击导航树中的“警报目标”节点以查看当前定义的目标。该窗格显示用户提供的目标名称和目标类型，可以是电子邮件或SNMP。

image:alerts-destination-view.png[图片]

点击新建目的地按钮创建一个新的目的地。 “添加警报目标”窗格打开。首先输入目的地的名称并选择目的地类型。从Type下拉列表中，选择目标的类型：电子邮件或SNMP。 （请参阅下文。）+
  image:alert-dest1.png[图片]

根据您选择的目标类型，系统会提示您输入其他字段。

== 配置电子邮件目的地

添加电子邮件类型的目的地时，您必须指定服务器和收件人用户信息。下图是配置电子邮件目的地的示例：+
  image:alerts-destination-add-email-google.png[图片]

对于电子邮件目的地，您需要指定以下内容：

*  SMTP服务器指定：您可以通过其IP地址（例如192.168.0.1）或其URL（如`smtp.mycompany.com`）识别SMTP服务器。
*  SMTP服务器端口号：服务器端口号，例如25。
* 用户电子邮件名称：收件人的电子邮件名称和地址，例如user@mycompany.com。
* 密码：收件人的电子邮件密码。

如果服务器需要安全环境，请检查TLS / SSL框。您必须将此字段设置为符合SMTP提供商的服务器配置。

完成后，点击保存完成添加目的地。

=== 电子邮件目的地的示例

以下示例显示如何为Google和Yahoo邮件收件人设置电子邮件目标。

对于Google邮件（Gmail），请按如下所示设置字段：

[%header,cols="2*"]
|===
|字段 |输入数据
|姓名 |警报目标的名称
| {键入{1}}电子邮件
| SMTP服务器 | smtp.googlemail.com
| SMTP端口 | 465
|Username |<username>@gmail.com
|密码 | <email password>
|使用TLS / SSL  |是的
|===

对于Yahoo邮件，请按如下所示设置字段：

[%header,cols="2*"]
|===
|字段 |输入数据
|姓名 |警报目标的名称
| {键入{1}}电子邮件
| SMTP服务器 | smtp.mail.yahoo.com
| SMTP端口 | 465
|用户名 | <username>
|密码 | <email password>
|使用TLS / SSL  |是的
|===

== 配置SNMP目标

SNMP类型的目标与电子邮件类型的目标具有不同的字段。下图是您可以如何设置SNMP目标的示例：+
  image:alerts-destination-add-snmp.png[图片]

为SNMP目标指定以下内容：

*  OID：目标的标识名称。您输入的OID需要符合SNMP约定。例如，有效的OID可能是`1.3.6`。
* 本地地址：绑定目标的本地SNMP地址。地址必须符合SNMP约定。本地地址的例子可能是`udp:localhost`
* 目标地址：发送警报通知的SNMP目标地址。该地址也必须符合SNMP约定。例如，您可以输入地址，例如`udp:localhost`
* 版本：SNMP版本号。默认值是2c。
* 用户名：SNMP用户名。
* 密码：用户密码。
* 密码短语：用户识别密码短语。

完成后，点击保存完成添加目的地。

要编辑目标，请双击“警报目标”窗格中的目标条目。编辑窗格显示为该目的地输入的数据，您可以根据需要更改值。

== 指定通知

在为通知定义可能的目的地后设置通知。当您创建新通知时，您必须从已定义目标的列表中选择通知的目的地。

单击导航树中的“警报通知”节点可查看已定义的警报通知。该窗格显示所有警报通知及其目的地的名称。

image:alerts-notification-view.png[图片]

要创建新通知，请点击新建通知按钮。 “添加警报通知”窗格随即打开。 （请参阅下文。）+
  image:alerts-notification-add.png[图片]

输入通知的名称。为通知指定过滤器是可选的，并在下一段中介绍。从Destination下拉列表中选择通知目的地。如果您尚未定义目的地，则该列表为空，您无法完成通知规范。

您可以选择指定一个或多个过滤器。当您单击窗格中间的添加按钮时，窗格将显示一个表，您可以在其中指定过滤器字段和这些字段的值。您可以根据需要添加尽可能多的过滤器字段。从字段下拉菜单中选择每个过滤器字段。 Value下拉菜单显示与选定字段对应的值。 （下图是一个例子。）

image:alerts-notification-filter.png[图片]

对于您指定的每个过滤器字段，请务必单击“字段/值”表下方的“保存”按钮以保存该过滤器，或单击“取消”以放弃条目。如果需要，您可以选择过滤字段并将其删除。单击添加按钮添加其他过滤器，但请确保您单击保存或取消，然后指定这些额外的过滤器字段。

例如，下图显示了如何在Alert字段上过滤通知。选择“字段列”的警报后，“值”列将显示已定义的所有警报，并且您可以从列表中选择警报值。

image:alerts-notification-filter1.png[图片]

过滤器表格显示所有添加的过滤器。您可以通过单击“值”列右侧的红色X来删除已添加的所有过滤器。

image:alerts-notification-filter2.png[图片]

如果您选择的目标类型是电子邮件，则输入电子邮件收件人姓名，发件人姓名，主题和电子邮件正文的文本。您必须输入所有这些字段的数据（请参阅下图。）+
  image:alerts-notification-destination-email.png[图片]

对于电子邮件目的地，您可以在主题和正文字段中使用表达式。要使用表达式并正确解释表达式，必须将表达式括在大括号中，并在其前加上美元符号（$）符号，如下所示。例如：

您可以将表达式与其他一些文字组合在一起。例如，您可能希望显示标准消息的主题行警报已被触发，但还包括一个表示警报条件的表达式。您可以如下设置主题字段：

image:alerts-notification-subject-email.png[图片]

请参阅下文，了解有关可用于这些警报表达式的属性的更多信息。

当目标类型为SNMP时，系统会提示您输入一个值，如下所示。您必须输入值字段的数据才能保存通知。 +
  image:alerts-notification-snmp.png[图片]

对于所有通知，请务必在输入所有必需数据后单击保存按钮。注意保存按钮是灰色的，直到所有必填字段完成。

要编辑通知，请双击警报通知窗格中的通知条目。编辑窗格显示为该通知输入的数据，您可以根据需要更改值。

警报表达式中使用的== 属性

有许多属性的值可以合并到警报目标和通知中。您可以使用上面显示的表达式语法合并这些属性。某些属性对所有警报类型都是通用的，而其他属性则属于特定的警报类型。

以下属性对所有警报类型都是通用的。 （类`com.mulesoft.console.alert.RaisedAlert`包含警报属性的声明。）

[%header,cols="2*"]
|===
|属性 |说明
| id  |警报标识
|姓名 |警报名称
| serverId  |服务器标识符
| serverName  |服务器名称
|描述 |提醒警报的描述
|时间戳 |提醒时间
|来源 |提出警报的来源
|严重性 |警报的严重程度，如致命或严重
|类型 |警报的类型，例如低内存或异常
|===

除了上面显示的通用属性之外，某些警报类型还有其他可访问的属性。下表显示了定义附加属性的警报类型和特定属性。

[%header,cols="34,33,33"]
|===
|警报类型 |属性 |说明
|例外提示 |   | 
|   | exceptionMessage  |描述异常的简短文本消息
|   | exceptionFullMessage  |描述异常的完整或完整文本消息
|   | exceptionRootCause  |异常的原因
|基于阈值的警报（可能是自定义，线程池或JMX警报） |   | 
|   | actualValue  |导致警报提升的值
|   |阈值 |引发警报的阈值
|   | thresholdEventType  |引发警报的事件的类型
|网址健康警报 |   | 
|   | urlStatus  |来自URL的错误状态标识符
|   | urlMessage  |来自URL的错误消息
|日志提示 |   | 
|   | logFile  |日志文件名称
|   | logLine  |日志文件中的行
|===
